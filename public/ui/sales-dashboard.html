<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>销售工作台 - LIMS-XW</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family:
          -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC',
          'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
        background: #f5f7fa;
        min-height: 100vh;
      }

      /* 主内容区 */
      .main-content {
        padding: 20px;
        max-width: 1400px;
        margin: 0 auto;
      }

      /* 页面标题 */
      .page-header {
        margin-bottom: 24px;
      }

      .page-title {
        font-size: 28px;
        color: #1f2937;
        font-weight: bold;
        margin-bottom: 8px;
      }

      .breadcrumb {
        color: #6b7280;
        font-size: 14px;
      }

      /* 统计卡片 */
      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .stat-card {
        background: white;
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        transition:
          transform 0.2s,
          box-shadow 0.2s;
      }

      .stat-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      .stat-label {
        color: #6b7280;
        font-size: 14px;
        margin-bottom: 8px;
      }

      .stat-value {
        font-size: 32px;
        font-weight: bold;
        color: #1f2937;
        margin-bottom: 4px;
      }

      .stat-change {
        font-size: 12px;
        color: #10b981;
      }

      .stat-change.negative {
        color: #ef4444;
      }

      /* 操作按钮 */
      .action-buttons {
        display: flex;
        gap: 16px;
        margin-bottom: 24px;
      }

      .btn-primary {
        padding: 12px 24px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition:
          transform 0.2s,
          box-shadow 0.2s;
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
      }

      .btn-secondary {
        padding: 12px 24px;
        background: white;
        color: #667eea;
        border: 1px solid #667eea;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
      }

      .btn-secondary:hover {
        background: #f3f4f6;
      }

      /* 订单列表头部 */
      .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        flex-wrap: wrap;
        gap: 16px;
      }

      .section-title {
        font-size: 20px;
        font-weight: bold;
        color: #1f2937;
      }

      /* 搜索和筛选区域 */
      .search-filter {
        display: flex;
        gap: 12px;
        align-items: center;
        flex-wrap: wrap;
      }

      .search-box {
        position: relative;
        display: flex;
        align-items: center;
      }

      .search-input {
        padding: 8px 36px 8px 36px;
        border: 1px solid #e5e7eb;
        border-radius: 6px;
        font-size: 14px;
        width: 200px;
        transition: all 0.2s;
      }

      .search-input:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      .search-icon {
        position: absolute;
        left: 12px;
        color: #9ca3af;
        pointer-events: none;
      }

      .clear-icon {
        position: absolute;
        right: 12px;
        color: #9ca3af;
        cursor: pointer;
        display: none;
        padding: 4px;
        transition: color 0.2s;
      }

      .clear-icon:hover {
        color: #6b7280;
      }

      .search-box.has-value .clear-icon {
        display: block;
      }

      .search-btn {
        padding: 8px 16px;
        background: #667eea;
        color: white;
        border: none;
        border-radius: 6px;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        gap: 4px;
      }

      .search-btn:hover {
        background: #5a67d8;
      }

      .filter-select {
        padding: 8px 16px;
        border: 1px solid #e5e7eb;
        border-radius: 6px;
        font-size: 14px;
        background: white;
        cursor: pointer;
        transition: all 0.2s;
      }

      .filter-select:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      /* 订单表格容器 */
      .order-table-container {
        background: white;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        position: relative;
        min-height: 400px;
      }

      /* 加载状态 */
      .loading-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(255, 255, 255, 0.9);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 10;
      }

      .loading-overlay.active {
        display: flex;
      }

      .loading-spinner {
        width: 40px;
        height: 40px;
        border: 3px solid #f3f4f6;
        border-top: 3px solid #667eea;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* 空状态 */
      .empty-state {
        text-align: center;
        padding: 60px 20px;
        display: none;
      }

      .empty-state.active {
        display: block;
      }

      .empty-icon {
        font-size: 48px;
        color: #d1d5db;
        margin-bottom: 16px;
      }

      .empty-title {
        font-size: 16px;
        color: #6b7280;
        margin-bottom: 8px;
      }

      .empty-desc {
        font-size: 14px;
        color: #9ca3af;
      }

      /* 表格样式 */
      .order-table {
        width: 100%;
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }

      thead {
        background: #f9fafb;
        border-bottom: 1px solid #e5e7eb;
      }

      th {
        padding: 12px 16px;
        text-align: left;
        font-size: 14px;
        font-weight: 500;
        color: #6b7280;
      }

      tbody tr {
        border-bottom: 1px solid #f3f4f6;
        transition: background 0.2s;
      }

      tbody tr:hover {
        background: #f9fafb;
      }

      td {
        padding: 12px 16px;
        font-size: 14px;
        color: #1f2937;
      }

      .order-id {
        color: #667eea;
        font-weight: 500;
        cursor: pointer;
      }

      .order-id:hover {
        text-decoration: underline;
      }

      .status-badge {
        display: inline-block;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: 500;
      }

      .status-pending {
        background: #fef3c7;
        color: #92400e;
      }

      .status-approved {
        background: #d1fae5;
        color: #065f46;
      }

      .status-sampling {
        background: #dbeafe;
        color: #1e40af;
      }

      .status-testing {
        background: #e9d5ff;
        color: #6b21a8;
      }

      .status-completed {
        background: #d1fae5;
        color: #065f46;
      }

      .urgent-badge {
        display: inline-block;
        padding: 2px 6px;
        background: #ef4444;
        color: white;
        border-radius: 4px;
        font-size: 11px;
        font-weight: bold;
        margin-left: 8px;
      }

      .table-actions {
        display: flex;
        gap: 8px;
      }

      .btn-action {
        padding: 4px 8px;
        background: transparent;
        color: #667eea;
        border: 1px solid #667eea;
        border-radius: 4px;
        font-size: 12px;
        cursor: pointer;
        transition: all 0.2s;
      }

      .btn-action:hover {
        background: #667eea;
        color: white;
      }

      /* 分页控件 */
      .pagination-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 16px 20px;
        background: white;
        border-top: 1px solid #e5e7eb;
        flex-wrap: wrap;
        gap: 16px;
      }

      .pagination-info {
        color: #6b7280;
        font-size: 14px;
      }

      .pagination-info strong {
        color: #1f2937;
        font-weight: 600;
      }

      .pagination-controls {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .page-btn {
        padding: 6px 12px;
        background: white;
        border: 1px solid #e5e7eb;
        border-radius: 6px;
        color: #6b7280;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.2s;
        min-width: 36px;
        text-align: center;
      }

      .page-btn:hover:not(:disabled) {
        background: #f9fafb;
        border-color: #d1d5db;
      }

      .page-btn.active {
        background: #667eea;
        color: white;
        border-color: #667eea;
      }

      .page-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .page-btn.nav-btn {
        display: flex;
        align-items: center;
        gap: 4px;
        padding: 6px 10px;
      }

      .page-jump {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-left: 16px;
      }

      .page-jump-input {
        width: 50px;
        padding: 6px 8px;
        border: 1px solid #e5e7eb;
        border-radius: 4px;
        font-size: 14px;
        text-align: center;
      }

      .page-jump-input:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      .page-jump-btn {
        padding: 6px 12px;
        background: #667eea;
        color: white;
        border: none;
        border-radius: 4px;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.2s;
      }

      .page-jump-btn:hover {
        background: #5a67d8;
      }

      /* 响应式设计 */
      @media (max-width: 768px) {
        .search-filter {
          flex-direction: column;
          width: 100%;
        }

        .search-input {
          width: 100%;
        }

        .filter-select {
          width: 100%;
        }

        .pagination-container {
          flex-direction: column;
          align-items: stretch;
        }

        .pagination-controls {
          justify-content: center;
        }

        .pagination-info {
          text-align: center;
        }

        table {
          font-size: 12px;
        }

        th,
        td {
          padding: 8px;
        }

        .table-actions {
          flex-direction: column;
        }
      }
    </style>
  </head>
  <body>
    <!-- 引入统一导航栏 -->
    <script src="navigation.js"></script>
    <!-- 导航栏由 navigation.js 自动生成 -->

    <!-- 主内容 -->
    <div class="main-content">
      <!-- 页面头部 -->
      <div class="page-header">
        <h2 class="page-title">销售工作台</h2>
        <div class="breadcrumb">首页 / 销售工作台</div>
      </div>

      <!-- 统计卡片 -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-label">当月订单数</div>
          <div class="stat-value">68</div>
          <div class="stat-change">↑ 12% 较上月</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">当月业绩</div>
          <div class="stat-value">¥285,600</div>
          <div class="stat-change">↑ 8.5% 较上月</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">当月实收金额</div>
          <div class="stat-value">¥198,200</div>
          <div class="stat-change negative">↓ 3.2% 较上月</div>
        </div>
      </div>

      <!-- 操作按钮 -->
      <div class="action-buttons">
        <button
          class="btn-primary"
          onclick="window.location.href='create-order.html'"
        >
          + 创建订单
        </button>
        <button
          class="btn-secondary"
          onclick="window.location.href='customer-management.html'"
        >
          客户管理
        </button>
      </div>

      <!-- 订单列表 -->
      <div class="section-header">
        <h3 class="section-title">订单列表</h3>
        <div class="search-filter">
          <!-- 项目编号搜索 -->
          <div class="search-box" id="projectSearchBox">
            <svg
              class="search-icon"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <circle cx="11" cy="11" r="8"></circle>
              <path d="m21 21-4.35-4.35"></path>
            </svg>
            <input
              type="text"
              id="projectIdSearch"
              class="search-input"
              placeholder="项目编号精确查询"
            />
            <svg
              class="clear-icon"
              onclick="clearSearch('projectIdSearch')"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </div>

          <!-- 客户名称搜索 -->
          <div class="search-box" id="customerSearchBox">
            <svg
              class="search-icon"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <circle cx="11" cy="11" r="8"></circle>
              <path d="m21 21-4.35-4.35"></path>
            </svg>
            <input
              type="text"
              id="customerNameSearch"
              class="search-input"
              placeholder="客户名称模糊查询"
            />
            <svg
              class="clear-icon"
              onclick="clearSearch('customerNameSearch')"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </div>

          <!-- 状态筛选 -->
          <select class="filter-select" id="statusFilter">
            <option value="">全部状态</option>
            <option value="pending">待审核</option>
            <option value="approved">已审核</option>
            <option value="sampling">采样中</option>
            <option value="testing">检测中</option>
            <option value="completed">已完成</option>
          </select>

          <!-- 搜索按钮 -->
          <button class="search-btn" onclick="performSearch()">
            <svg
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <circle cx="11" cy="11" r="8"></circle>
              <path d="m21 21-4.35-4.35"></path>
            </svg>
            搜索
          </button>
        </div>
      </div>

      <div class="order-table-container">
        <!-- 加载状态 -->
        <div class="loading-overlay" id="loadingOverlay">
          <div class="loading-spinner"></div>
        </div>

        <!-- 空状态 -->
        <div class="empty-state" id="emptyState">
          <div class="empty-icon">📋</div>
          <div class="empty-title">暂无订单数据</div>
          <div class="empty-desc">请调整查询条件后重试</div>
        </div>

        <!-- 订单表格 -->
        <div class="order-table" id="orderTable">
          <table>
            <thead>
              <tr>
                <th>项目编号</th>
                <th>客户名称</th>
                <th>受检单位</th>
                <th>检测类型</th>
                <th>检测点数</th>
                <th>项目金额</th>
                <th>状态</th>
                <th>创建时间</th>
                <th>操作</th>
              </tr>
            </thead>
            <tbody id="orderTableBody">
              <!-- 动态生成的订单行 -->
            </tbody>
          </table>
        </div>

        <!-- 分页控件 -->
        <div class="pagination-container" id="paginationContainer">
          <div class="pagination-info">
            显示 <strong id="startRecord">1</strong> -
            <strong id="endRecord">10</strong> 条， 共
            <strong id="totalRecords">0</strong> 条记录
          </div>
          <div class="pagination-controls">
            <button
              class="page-btn nav-btn"
              id="firstPageBtn"
              onclick="goToPage(1)"
            >
              <svg
                width="14"
                height="14"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <polyline points="11 17 6 12 11 7"></polyline>
                <polyline points="18 17 13 12 18 7"></polyline>
              </svg>
              首页
            </button>
            <button
              class="page-btn nav-btn"
              id="prevPageBtn"
              onclick="previousPage()"
            >
              <svg
                width="14"
                height="14"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <polyline points="15 18 9 12 15 6"></polyline>
              </svg>
              上一页
            </button>
            <div id="pageNumbers">
              <!-- 动态生成的页码按钮 -->
            </div>
            <button
              class="page-btn nav-btn"
              id="nextPageBtn"
              onclick="nextPage()"
            >
              下一页
              <svg
                width="14"
                height="14"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <polyline points="9 18 15 12 9 6"></polyline>
              </svg>
            </button>
            <button
              class="page-btn nav-btn"
              id="lastPageBtn"
              onclick="goToPage(totalPages)"
            >
              末页
              <svg
                width="14"
                height="14"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <polyline points="13 17 18 12 13 7"></polyline>
                <polyline points="6 17 11 12 6 7"></polyline>
              </svg>
            </button>
            <div class="page-jump">
              <span style="color: #6b7280; font-size: 14px">跳转到</span>
              <input
                type="number"
                class="page-jump-input"
                id="pageJumpInput"
                min="1"
                placeholder="页码"
              />
              <button class="page-jump-btn" onclick="jumpToPage()">GO</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // 全局变量
      let allOrders = [] // 所有订单数据
      let filteredOrders = [] // 过滤后的订单数据
      let currentPage = 1 // 当前页码
      let pageSize = 10 // 每页显示条数
      let totalPages = 0 // 总页数
      let searchTimer = null // 防抖定时器

      // 初始化订单数据（模拟数据）
      function initOrderData() {
        const customers = [
          '广州环保科技有限公司',
          '深圳创新工业园',
          '佛山制造企业',
          '东莞电子厂',
          '惠州化工园区',
          '中山医药公司',
          '珠海食品厂',
          '江门纺织厂',
          '肇庆钢铁集团',
          '清远建材公司',
          '韶关矿业集团',
          '汕头塑料厂',
          '潮州陶瓷公司',
          '揭阳五金厂',
          '茂名石化公司',
          '湛江水产公司',
          '阳江刀具厂',
          '云浮石材公司',
          '河源电子园',
          '梅州制药厂'
        ]

        const testTypes = [
          '50325-2020',
          '生活饮用水',
          '工业废水',
          '洁净室环境',
          '土壤重金属',
          '空气质量',
          '噪声监测',
          '辐射检测',
          '食品安全',
          '药品质量',
          '化妆品检测',
          '材料成分'
        ]

        const statuses = [
          'pending',
          'approved',
          'sampling',
          'testing',
          'completed'
        ]
        const statusNames = {
          pending: '待审核',
          approved: '已审核',
          sampling: '采样中',
          testing: '检测中',
          completed: '已完成'
        }

        // 生成35条模拟数据
        allOrders = []
        for (let i = 35; i >= 1; i--) {
          const date = new Date()
          date.setDate(date.getDate() - (35 - i))
          const customer =
            customers[Math.floor(Math.random() * customers.length)]
          const statusKey =
            statuses[Math.floor(Math.random() * statuses.length)]

          allOrders.push({
            projectId: `XW250903-${String(100 + i).padStart(3, '0')}`,
            customerName: customer,
            inspectionUnit: customer + (Math.random() > 0.5 ? '总部' : 'A区'),
            testType: testTypes[Math.floor(Math.random() * testTypes.length)],
            testPoints: Math.floor(Math.random() * 25) + 5,
            amount: (Math.floor(Math.random() * 20) + 5) * 1000,
            status: statusKey,
            statusName: statusNames[statusKey],
            createTime: formatDate(date),
            isUrgent: Math.random() > 0.8
          })
        }

        // 初始化显示所有数据
        filteredOrders = [...allOrders]
      }

      // 格式化日期
      function formatDate(date) {
        const year = date.getFullYear()
        const month = String(date.getMonth() + 1).padStart(2, '0')
        const day = String(date.getDate()).padStart(2, '0')
        const hours = String(date.getHours()).padStart(2, '0')
        const minutes = String(date.getMinutes()).padStart(2, '0')
        return `${year}-${month}-${day} ${hours}:${minutes}`
      }

      // 渲染表格
      function renderTable() {
        const tbody = document.getElementById('orderTableBody')
        const startIndex = (currentPage - 1) * pageSize
        const endIndex = Math.min(startIndex + pageSize, filteredOrders.length)
        const pageData = filteredOrders.slice(startIndex, endIndex)

        // 清空表格
        tbody.innerHTML = ''

        // 判断是否有数据
        if (pageData.length === 0) {
          document.getElementById('orderTable').style.display = 'none'
          document.getElementById('paginationContainer').style.display = 'none'
          document.getElementById('emptyState').classList.add('active')
          return
        } else {
          document.getElementById('orderTable').style.display = 'block'
          document.getElementById('paginationContainer').style.display = 'flex'
          document.getElementById('emptyState').classList.remove('active')
        }

        // 渲染数据行
        pageData.forEach(order => {
          const tr = document.createElement('tr')
          tr.innerHTML = `
                    <td>
                        <span class="order-id" onclick="window.location.href='order-detail.html'">${order.projectId}</span>
                        ${order.isUrgent ? '<span class="urgent-badge">加急</span>' : ''}
                    </td>
                    <td>${order.customerName}</td>
                    <td>${order.inspectionUnit}</td>
                    <td>${
                      order.testType === '50325-2020'
                        ? '<span style="color: #059669; font-weight: 500;">50325-2020</span>'
                        : order.testType
                    }</td>
                    <td>${order.testPoints}</td>
                    <td>¥${order.amount.toLocaleString()}</td>
                    <td><span class="status-badge status-${order.status}">${order.statusName}</span></td>
                    <td>${order.createTime}</td>
                    <td>
                        <div class="table-actions">
                            <button class="btn-action" onclick="window.location.href='order-detail.html'">查看</button>
                            <button class="btn-action">${order.status === 'completed' ? '下载报告' : '编辑'}</button>
                        </div>
                    </td>
                `
          tbody.appendChild(tr)
        })

        // 更新分页信息
        updatePagination()
      }

      // 更新分页控件
      function updatePagination() {
        totalPages = Math.ceil(filteredOrders.length / pageSize)
        const startRecord =
          filteredOrders.length === 0 ? 0 : (currentPage - 1) * pageSize + 1
        const endRecord = Math.min(
          currentPage * pageSize,
          filteredOrders.length
        )

        // 更新记录信息
        document.getElementById('startRecord').textContent = startRecord
        document.getElementById('endRecord').textContent = endRecord
        document.getElementById('totalRecords').textContent =
          filteredOrders.length

        // 更新页码按钮
        const pageNumbers = document.getElementById('pageNumbers')
        pageNumbers.innerHTML = ''

        // 计算显示的页码范围
        let startPage = Math.max(1, currentPage - 2)
        let endPage = Math.min(totalPages, currentPage + 2)

        // 调整范围以始终显示5个页码（如果可能）
        if (endPage - startPage < 4) {
          if (startPage === 1) {
            endPage = Math.min(totalPages, 5)
          } else if (endPage === totalPages) {
            startPage = Math.max(1, totalPages - 4)
          }
        }

        // 生成页码按钮
        for (let i = startPage; i <= endPage; i++) {
          const btn = document.createElement('button')
          btn.className = 'page-btn'
          btn.textContent = i
          btn.onclick = () => goToPage(i)
          if (i === currentPage) {
            btn.classList.add('active')
          }
          pageNumbers.appendChild(btn)
        }

        // 更新导航按钮状态
        document.getElementById('firstPageBtn').disabled = currentPage === 1
        document.getElementById('prevPageBtn').disabled = currentPage === 1
        document.getElementById('nextPageBtn').disabled =
          currentPage === totalPages || totalPages === 0
        document.getElementById('lastPageBtn').disabled =
          currentPage === totalPages || totalPages === 0

        // 显示/隐藏首页和末页按钮
        document.getElementById('firstPageBtn').style.display =
          totalPages > 5 ? 'flex' : 'none'
        document.getElementById('lastPageBtn').style.display =
          totalPages > 5 ? 'flex' : 'none'
      }

      // 跳转到指定页
      function goToPage(page) {
        if (page < 1 || page > totalPages) return
        currentPage = page
        renderTable()
      }

      // 上一页
      function previousPage() {
        if (currentPage > 1) {
          currentPage--
          renderTable()
        }
      }

      // 下一页
      function nextPage() {
        if (currentPage < totalPages) {
          currentPage++
          renderTable()
        }
      }

      // 跳转页面
      function jumpToPage() {
        const input = document.getElementById('pageJumpInput')
        const page = parseInt(input.value)
        if (page && page >= 1 && page <= totalPages) {
          goToPage(page)
          input.value = ''
        } else {
          alert(`请输入1到${totalPages}之间的页码`)
        }
      }

      // 执行搜索
      function performSearch() {
        showLoading()

        // 获取搜索条件
        const projectId = document
          .getElementById('projectIdSearch')
          .value.trim()
        const customerName = document
          .getElementById('customerNameSearch')
          .value.trim()
          .toLowerCase()
        const status = document.getElementById('statusFilter').value

        // 过滤数据
        filteredOrders = allOrders.filter(order => {
          // 项目编号精确匹配
          if (projectId && order.projectId !== projectId) {
            return false
          }

          // 客户名称模糊匹配
          if (
            customerName &&
            !order.customerName.toLowerCase().includes(customerName)
          ) {
            return false
          }

          // 状态筛选
          if (status && order.status !== status) {
            return false
          }

          return true
        })

        // 重置到第一页
        currentPage = 1

        // 模拟加载延迟
        setTimeout(() => {
          hideLoading()
          renderTable()
        }, 300)
      }

      // 清空搜索框
      function clearSearch(inputId) {
        document.getElementById(inputId).value = ''
        updateSearchBoxState(inputId)
        performSearch()
      }

      // 更新搜索框状态
      function updateSearchBoxState(inputId) {
        const input = document.getElementById(inputId)
        const searchBox = input.closest('.search-box')
        if (input.value) {
          searchBox.classList.add('has-value')
        } else {
          searchBox.classList.remove('has-value')
        }
      }

      // 显示加载状态
      function showLoading() {
        document.getElementById('loadingOverlay').classList.add('active')
      }

      // 隐藏加载状态
      function hideLoading() {
        document.getElementById('loadingOverlay').classList.remove('active')
      }

      // 防抖函数
      function debounce(func, wait) {
        return function executedFunction(...args) {
          const later = () => {
            clearTimeout(searchTimer)
            func(...args)
          }
          clearTimeout(searchTimer)
          searchTimer = setTimeout(later, wait)
        }
      }

      // 页面初始化
      document.addEventListener('DOMContentLoaded', () => {
        // 设置页面标题
        if (window.limsNav) {
          window.limsNav.setPageTitle('销售工作台')
        }

        // 初始化数据
        initOrderData()
        renderTable()

        // 绑定搜索框事件
        const projectIdInput = document.getElementById('projectIdSearch')
        const customerNameInput = document.getElementById('customerNameSearch')

        // 实时搜索（防抖处理）
        const debouncedSearch = debounce(performSearch, 500)

        projectIdInput.addEventListener('input', function () {
          updateSearchBoxState('projectIdSearch')
          debouncedSearch()
        })

        customerNameInput.addEventListener('input', function () {
          updateSearchBoxState('customerNameSearch')
          debouncedSearch()
        })

        // 状态筛选变化时立即搜索
        document
          .getElementById('statusFilter')
          .addEventListener('change', performSearch)

        // 回车键触发搜索
        projectIdInput.addEventListener('keypress', function (e) {
          if (e.key === 'Enter') {
            performSearch()
          }
        })

        customerNameInput.addEventListener('keypress', function (e) {
          if (e.key === 'Enter') {
            performSearch()
          }
        })

        // 跳转输入框回车事件
        document
          .getElementById('pageJumpInput')
          .addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
              jumpToPage()
            }
          })
      })
    </script>
  </body>
</html>
