<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>é”€å”®å·¥ä½œå° - LIMS-XW</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family:
          -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC',
          'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
        background: #f5f7fa;
        min-height: 100vh;
      }

      /* ä¸»å†…å®¹åŒº */
      .main-content {
        padding: 20px;
        max-width: 1400px;
        margin: 0 auto;
      }

      /* é¡µé¢æ ‡é¢˜ */
      .page-header {
        margin-bottom: 24px;
      }

      .page-title {
        font-size: 28px;
        color: #1f2937;
        font-weight: bold;
        margin-bottom: 8px;
      }

      .breadcrumb {
        color: #6b7280;
        font-size: 14px;
      }

      /* ç»Ÿè®¡å¡ç‰‡ */
      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .stat-card {
        background: white;
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        transition:
          transform 0.2s,
          box-shadow 0.2s;
      }

      .stat-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      .stat-label {
        color: #6b7280;
        font-size: 14px;
        margin-bottom: 8px;
      }

      .stat-value {
        font-size: 32px;
        font-weight: bold;
        color: #1f2937;
        margin-bottom: 4px;
      }

      .stat-change {
        font-size: 12px;
        color: #10b981;
      }

      .stat-change.negative {
        color: #ef4444;
      }

      /* æ“ä½œæŒ‰é’® */
      .action-buttons {
        display: flex;
        gap: 16px;
        margin-bottom: 24px;
      }

      .btn-primary {
        padding: 12px 24px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition:
          transform 0.2s,
          box-shadow 0.2s;
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
      }

      .btn-secondary {
        padding: 12px 24px;
        background: white;
        color: #667eea;
        border: 1px solid #667eea;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
      }

      .btn-secondary:hover {
        background: #f3f4f6;
      }

      /* è®¢å•åˆ—è¡¨å¤´éƒ¨ */
      .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        flex-wrap: wrap;
        gap: 16px;
      }

      .section-title {
        font-size: 20px;
        font-weight: bold;
        color: #1f2937;
      }

      /* æœç´¢å’Œç­›é€‰åŒºåŸŸ */
      .search-filter {
        display: flex;
        gap: 12px;
        align-items: center;
        flex-wrap: wrap;
      }

      .search-box {
        position: relative;
        display: flex;
        align-items: center;
      }

      .search-input {
        padding: 8px 36px 8px 36px;
        border: 1px solid #e5e7eb;
        border-radius: 6px;
        font-size: 14px;
        width: 200px;
        transition: all 0.2s;
      }

      .search-input:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      .search-icon {
        position: absolute;
        left: 12px;
        color: #9ca3af;
        pointer-events: none;
      }

      .clear-icon {
        position: absolute;
        right: 12px;
        color: #9ca3af;
        cursor: pointer;
        display: none;
        padding: 4px;
        transition: color 0.2s;
      }

      .clear-icon:hover {
        color: #6b7280;
      }

      .search-box.has-value .clear-icon {
        display: block;
      }

      .search-btn {
        padding: 8px 16px;
        background: #667eea;
        color: white;
        border: none;
        border-radius: 6px;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        gap: 4px;
      }

      .search-btn:hover {
        background: #5a67d8;
      }

      .filter-select {
        padding: 8px 16px;
        border: 1px solid #e5e7eb;
        border-radius: 6px;
        font-size: 14px;
        background: white;
        cursor: pointer;
        transition: all 0.2s;
      }

      .filter-select:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      /* è®¢å•è¡¨æ ¼å®¹å™¨ */
      .order-table-container {
        background: white;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        position: relative;
        min-height: 400px;
      }

      /* åŠ è½½çŠ¶æ€ */
      .loading-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(255, 255, 255, 0.9);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 10;
      }

      .loading-overlay.active {
        display: flex;
      }

      .loading-spinner {
        width: 40px;
        height: 40px;
        border: 3px solid #f3f4f6;
        border-top: 3px solid #667eea;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* ç©ºçŠ¶æ€ */
      .empty-state {
        text-align: center;
        padding: 60px 20px;
        display: none;
      }

      .empty-state.active {
        display: block;
      }

      .empty-icon {
        font-size: 48px;
        color: #d1d5db;
        margin-bottom: 16px;
      }

      .empty-title {
        font-size: 16px;
        color: #6b7280;
        margin-bottom: 8px;
      }

      .empty-desc {
        font-size: 14px;
        color: #9ca3af;
      }

      /* è¡¨æ ¼æ ·å¼ */
      .order-table {
        width: 100%;
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }

      thead {
        background: #f9fafb;
        border-bottom: 1px solid #e5e7eb;
      }

      th {
        padding: 12px 16px;
        text-align: left;
        font-size: 14px;
        font-weight: 500;
        color: #6b7280;
      }

      tbody tr {
        border-bottom: 1px solid #f3f4f6;
        transition: background 0.2s;
      }

      tbody tr:hover {
        background: #f9fafb;
      }

      td {
        padding: 12px 16px;
        font-size: 14px;
        color: #1f2937;
      }

      .order-id {
        color: #667eea;
        font-weight: 500;
        cursor: pointer;
      }

      .order-id:hover {
        text-decoration: underline;
      }

      .status-badge {
        display: inline-block;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: 500;
      }

      .status-pending {
        background: #fef3c7;
        color: #92400e;
      }

      .status-approved {
        background: #d1fae5;
        color: #065f46;
      }

      .status-sampling {
        background: #dbeafe;
        color: #1e40af;
      }

      .status-testing {
        background: #e9d5ff;
        color: #6b21a8;
      }

      .status-completed {
        background: #d1fae5;
        color: #065f46;
      }

      .urgent-badge {
        display: inline-block;
        padding: 2px 6px;
        background: #ef4444;
        color: white;
        border-radius: 4px;
        font-size: 11px;
        font-weight: bold;
        margin-left: 8px;
      }

      .table-actions {
        display: flex;
        gap: 8px;
      }

      .btn-action {
        padding: 4px 8px;
        background: transparent;
        color: #667eea;
        border: 1px solid #667eea;
        border-radius: 4px;
        font-size: 12px;
        cursor: pointer;
        transition: all 0.2s;
      }

      .btn-action:hover {
        background: #667eea;
        color: white;
      }

      /* åˆ†é¡µæ§ä»¶ */
      .pagination-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 16px 20px;
        background: white;
        border-top: 1px solid #e5e7eb;
        flex-wrap: wrap;
        gap: 16px;
      }

      .pagination-info {
        color: #6b7280;
        font-size: 14px;
      }

      .pagination-info strong {
        color: #1f2937;
        font-weight: 600;
      }

      .pagination-controls {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .page-btn {
        padding: 6px 12px;
        background: white;
        border: 1px solid #e5e7eb;
        border-radius: 6px;
        color: #6b7280;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.2s;
        min-width: 36px;
        text-align: center;
      }

      .page-btn:hover:not(:disabled) {
        background: #f9fafb;
        border-color: #d1d5db;
      }

      .page-btn.active {
        background: #667eea;
        color: white;
        border-color: #667eea;
      }

      .page-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .page-btn.nav-btn {
        display: flex;
        align-items: center;
        gap: 4px;
        padding: 6px 10px;
      }

      .page-jump {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-left: 16px;
      }

      .page-jump-input {
        width: 50px;
        padding: 6px 8px;
        border: 1px solid #e5e7eb;
        border-radius: 4px;
        font-size: 14px;
        text-align: center;
      }

      .page-jump-input:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      .page-jump-btn {
        padding: 6px 12px;
        background: #667eea;
        color: white;
        border: none;
        border-radius: 4px;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.2s;
      }

      .page-jump-btn:hover {
        background: #5a67d8;
      }

      /* å“åº”å¼è®¾è®¡ */
      @media (max-width: 768px) {
        .search-filter {
          flex-direction: column;
          width: 100%;
        }

        .search-input {
          width: 100%;
        }

        .filter-select {
          width: 100%;
        }

        .pagination-container {
          flex-direction: column;
          align-items: stretch;
        }

        .pagination-controls {
          justify-content: center;
        }

        .pagination-info {
          text-align: center;
        }

        table {
          font-size: 12px;
        }

        th,
        td {
          padding: 8px;
        }

        .table-actions {
          flex-direction: column;
        }
      }
    </style>
  </head>
  <body>
    <!-- å¼•å…¥ç»Ÿä¸€å¯¼èˆªæ  -->
    <script src="navigation.js"></script>
    <!-- å¯¼èˆªæ ç”± navigation.js è‡ªåŠ¨ç”Ÿæˆ -->

    <!-- ä¸»å†…å®¹ -->
    <div class="main-content">
      <!-- é¡µé¢å¤´éƒ¨ -->
      <div class="page-header">
        <h2 class="page-title">é”€å”®å·¥ä½œå°</h2>
        <div class="breadcrumb">é¦–é¡µ / é”€å”®å·¥ä½œå°</div>
      </div>

      <!-- ç»Ÿè®¡å¡ç‰‡ -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-label">å½“æœˆè®¢å•æ•°</div>
          <div class="stat-value">68</div>
          <div class="stat-change">â†‘ 12% è¾ƒä¸Šæœˆ</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">å½“æœˆä¸šç»©</div>
          <div class="stat-value">Â¥285,600</div>
          <div class="stat-change">â†‘ 8.5% è¾ƒä¸Šæœˆ</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">å½“æœˆå®æ”¶é‡‘é¢</div>
          <div class="stat-value">Â¥198,200</div>
          <div class="stat-change negative">â†“ 3.2% è¾ƒä¸Šæœˆ</div>
        </div>
      </div>

      <!-- æ“ä½œæŒ‰é’® -->
      <div class="action-buttons">
        <button
          class="btn-primary"
          onclick="window.location.href='create-order.html'"
        >
          + åˆ›å»ºè®¢å•
        </button>
        <button
          class="btn-secondary"
          onclick="window.location.href='customer-management.html'"
        >
          å®¢æˆ·ç®¡ç†
        </button>
      </div>

      <!-- è®¢å•åˆ—è¡¨ -->
      <div class="section-header">
        <h3 class="section-title">è®¢å•åˆ—è¡¨</h3>
        <div class="search-filter">
          <!-- é¡¹ç›®ç¼–å·æœç´¢ -->
          <div class="search-box" id="projectSearchBox">
            <svg
              class="search-icon"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <circle cx="11" cy="11" r="8"></circle>
              <path d="m21 21-4.35-4.35"></path>
            </svg>
            <input
              type="text"
              id="projectIdSearch"
              class="search-input"
              placeholder="é¡¹ç›®ç¼–å·ç²¾ç¡®æŸ¥è¯¢"
            />
            <svg
              class="clear-icon"
              onclick="clearSearch('projectIdSearch')"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </div>

          <!-- å®¢æˆ·åç§°æœç´¢ -->
          <div class="search-box" id="customerSearchBox">
            <svg
              class="search-icon"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <circle cx="11" cy="11" r="8"></circle>
              <path d="m21 21-4.35-4.35"></path>
            </svg>
            <input
              type="text"
              id="customerNameSearch"
              class="search-input"
              placeholder="å®¢æˆ·åç§°æ¨¡ç³ŠæŸ¥è¯¢"
            />
            <svg
              class="clear-icon"
              onclick="clearSearch('customerNameSearch')"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </div>

          <!-- çŠ¶æ€ç­›é€‰ -->
          <select class="filter-select" id="statusFilter">
            <option value="">å…¨éƒ¨çŠ¶æ€</option>
            <option value="pending">å¾…å®¡æ ¸</option>
            <option value="approved">å·²å®¡æ ¸</option>
            <option value="sampling">é‡‡æ ·ä¸­</option>
            <option value="testing">æ£€æµ‹ä¸­</option>
            <option value="completed">å·²å®Œæˆ</option>
          </select>

          <!-- æœç´¢æŒ‰é’® -->
          <button class="search-btn" onclick="performSearch()">
            <svg
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <circle cx="11" cy="11" r="8"></circle>
              <path d="m21 21-4.35-4.35"></path>
            </svg>
            æœç´¢
          </button>
        </div>
      </div>

      <div class="order-table-container">
        <!-- åŠ è½½çŠ¶æ€ -->
        <div class="loading-overlay" id="loadingOverlay">
          <div class="loading-spinner"></div>
        </div>

        <!-- ç©ºçŠ¶æ€ -->
        <div class="empty-state" id="emptyState">
          <div class="empty-icon">ğŸ“‹</div>
          <div class="empty-title">æš‚æ— è®¢å•æ•°æ®</div>
          <div class="empty-desc">è¯·è°ƒæ•´æŸ¥è¯¢æ¡ä»¶åé‡è¯•</div>
        </div>

        <!-- è®¢å•è¡¨æ ¼ -->
        <div class="order-table" id="orderTable">
          <table>
            <thead>
              <tr>
                <th>é¡¹ç›®ç¼–å·</th>
                <th>å®¢æˆ·åç§°</th>
                <th>å—æ£€å•ä½</th>
                <th>æ£€æµ‹ç±»å‹</th>
                <th>æ£€æµ‹ç‚¹æ•°</th>
                <th>é¡¹ç›®é‡‘é¢</th>
                <th>çŠ¶æ€</th>
                <th>åˆ›å»ºæ—¶é—´</th>
                <th>æ“ä½œ</th>
              </tr>
            </thead>
            <tbody id="orderTableBody">
              <!-- åŠ¨æ€ç”Ÿæˆçš„è®¢å•è¡Œ -->
            </tbody>
          </table>
        </div>

        <!-- åˆ†é¡µæ§ä»¶ -->
        <div class="pagination-container" id="paginationContainer">
          <div class="pagination-info">
            æ˜¾ç¤º <strong id="startRecord">1</strong> -
            <strong id="endRecord">10</strong> æ¡ï¼Œ å…±
            <strong id="totalRecords">0</strong> æ¡è®°å½•
          </div>
          <div class="pagination-controls">
            <button
              class="page-btn nav-btn"
              id="firstPageBtn"
              onclick="goToPage(1)"
            >
              <svg
                width="14"
                height="14"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <polyline points="11 17 6 12 11 7"></polyline>
                <polyline points="18 17 13 12 18 7"></polyline>
              </svg>
              é¦–é¡µ
            </button>
            <button
              class="page-btn nav-btn"
              id="prevPageBtn"
              onclick="previousPage()"
            >
              <svg
                width="14"
                height="14"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <polyline points="15 18 9 12 15 6"></polyline>
              </svg>
              ä¸Šä¸€é¡µ
            </button>
            <div id="pageNumbers">
              <!-- åŠ¨æ€ç”Ÿæˆçš„é¡µç æŒ‰é’® -->
            </div>
            <button
              class="page-btn nav-btn"
              id="nextPageBtn"
              onclick="nextPage()"
            >
              ä¸‹ä¸€é¡µ
              <svg
                width="14"
                height="14"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <polyline points="9 18 15 12 9 6"></polyline>
              </svg>
            </button>
            <button
              class="page-btn nav-btn"
              id="lastPageBtn"
              onclick="goToPage(totalPages)"
            >
              æœ«é¡µ
              <svg
                width="14"
                height="14"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <polyline points="13 17 18 12 13 7"></polyline>
                <polyline points="6 17 11 12 6 7"></polyline>
              </svg>
            </button>
            <div class="page-jump">
              <span style="color: #6b7280; font-size: 14px">è·³è½¬åˆ°</span>
              <input
                type="number"
                class="page-jump-input"
                id="pageJumpInput"
                min="1"
                placeholder="é¡µç "
              />
              <button class="page-jump-btn" onclick="jumpToPage()">GO</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // å…¨å±€å˜é‡
      let allOrders = [] // æ‰€æœ‰è®¢å•æ•°æ®
      let filteredOrders = [] // è¿‡æ»¤åçš„è®¢å•æ•°æ®
      let currentPage = 1 // å½“å‰é¡µç 
      let pageSize = 10 // æ¯é¡µæ˜¾ç¤ºæ¡æ•°
      let totalPages = 0 // æ€»é¡µæ•°
      let searchTimer = null // é˜²æŠ–å®šæ—¶å™¨

      // åˆå§‹åŒ–è®¢å•æ•°æ®ï¼ˆæ¨¡æ‹Ÿæ•°æ®ï¼‰
      function initOrderData() {
        const customers = [
          'å¹¿å·ç¯ä¿ç§‘æŠ€æœ‰é™å…¬å¸',
          'æ·±åœ³åˆ›æ–°å·¥ä¸šå›­',
          'ä½›å±±åˆ¶é€ ä¼ä¸š',
          'ä¸œèç”µå­å‚',
          'æƒ å·åŒ–å·¥å›­åŒº',
          'ä¸­å±±åŒ»è¯å…¬å¸',
          'ç æµ·é£Ÿå“å‚',
          'æ±Ÿé—¨çººç»‡å‚',
          'è‚‡åº†é’¢é“é›†å›¢',
          'æ¸…è¿œå»ºæå…¬å¸',
          'éŸ¶å…³çŸ¿ä¸šé›†å›¢',
          'æ±•å¤´å¡‘æ–™å‚',
          'æ½®å·é™¶ç“·å…¬å¸',
          'æ­é˜³äº”é‡‘å‚',
          'èŒ‚åçŸ³åŒ–å…¬å¸',
          'æ¹›æ±Ÿæ°´äº§å…¬å¸',
          'é˜³æ±Ÿåˆ€å…·å‚',
          'äº‘æµ®çŸ³æå…¬å¸',
          'æ²³æºç”µå­å›­',
          'æ¢…å·åˆ¶è¯å‚'
        ]

        const testTypes = [
          '50325-2020',
          'ç”Ÿæ´»é¥®ç”¨æ°´',
          'å·¥ä¸šåºŸæ°´',
          'æ´å‡€å®¤ç¯å¢ƒ',
          'åœŸå£¤é‡é‡‘å±',
          'ç©ºæ°”è´¨é‡',
          'å™ªå£°ç›‘æµ‹',
          'è¾å°„æ£€æµ‹',
          'é£Ÿå“å®‰å…¨',
          'è¯å“è´¨é‡',
          'åŒ–å¦†å“æ£€æµ‹',
          'ææ–™æˆåˆ†'
        ]

        const statuses = [
          'pending',
          'approved',
          'sampling',
          'testing',
          'completed'
        ]
        const statusNames = {
          pending: 'å¾…å®¡æ ¸',
          approved: 'å·²å®¡æ ¸',
          sampling: 'é‡‡æ ·ä¸­',
          testing: 'æ£€æµ‹ä¸­',
          completed: 'å·²å®Œæˆ'
        }

        // ç”Ÿæˆ35æ¡æ¨¡æ‹Ÿæ•°æ®
        allOrders = []
        for (let i = 35; i >= 1; i--) {
          const date = new Date()
          date.setDate(date.getDate() - (35 - i))
          const customer =
            customers[Math.floor(Math.random() * customers.length)]
          const statusKey =
            statuses[Math.floor(Math.random() * statuses.length)]

          allOrders.push({
            projectId: `XW250903-${String(100 + i).padStart(3, '0')}`,
            customerName: customer,
            inspectionUnit: customer + (Math.random() > 0.5 ? 'æ€»éƒ¨' : 'AåŒº'),
            testType: testTypes[Math.floor(Math.random() * testTypes.length)],
            testPoints: Math.floor(Math.random() * 25) + 5,
            amount: (Math.floor(Math.random() * 20) + 5) * 1000,
            status: statusKey,
            statusName: statusNames[statusKey],
            createTime: formatDate(date),
            isUrgent: Math.random() > 0.8
          })
        }

        // åˆå§‹åŒ–æ˜¾ç¤ºæ‰€æœ‰æ•°æ®
        filteredOrders = [...allOrders]
      }

      // æ ¼å¼åŒ–æ—¥æœŸ
      function formatDate(date) {
        const year = date.getFullYear()
        const month = String(date.getMonth() + 1).padStart(2, '0')
        const day = String(date.getDate()).padStart(2, '0')
        const hours = String(date.getHours()).padStart(2, '0')
        const minutes = String(date.getMinutes()).padStart(2, '0')
        return `${year}-${month}-${day} ${hours}:${minutes}`
      }

      // æ¸²æŸ“è¡¨æ ¼
      function renderTable() {
        const tbody = document.getElementById('orderTableBody')
        const startIndex = (currentPage - 1) * pageSize
        const endIndex = Math.min(startIndex + pageSize, filteredOrders.length)
        const pageData = filteredOrders.slice(startIndex, endIndex)

        // æ¸…ç©ºè¡¨æ ¼
        tbody.innerHTML = ''

        // åˆ¤æ–­æ˜¯å¦æœ‰æ•°æ®
        if (pageData.length === 0) {
          document.getElementById('orderTable').style.display = 'none'
          document.getElementById('paginationContainer').style.display = 'none'
          document.getElementById('emptyState').classList.add('active')
          return
        } else {
          document.getElementById('orderTable').style.display = 'block'
          document.getElementById('paginationContainer').style.display = 'flex'
          document.getElementById('emptyState').classList.remove('active')
        }

        // æ¸²æŸ“æ•°æ®è¡Œ
        pageData.forEach(order => {
          const tr = document.createElement('tr')
          tr.innerHTML = `
                    <td>
                        <span class="order-id" onclick="window.location.href='order-detail.html'">${order.projectId}</span>
                        ${order.isUrgent ? '<span class="urgent-badge">åŠ æ€¥</span>' : ''}
                    </td>
                    <td>${order.customerName}</td>
                    <td>${order.inspectionUnit}</td>
                    <td>${
                      order.testType === '50325-2020'
                        ? '<span style="color: #059669; font-weight: 500;">50325-2020</span>'
                        : order.testType
                    }</td>
                    <td>${order.testPoints}</td>
                    <td>Â¥${order.amount.toLocaleString()}</td>
                    <td><span class="status-badge status-${order.status}">${order.statusName}</span></td>
                    <td>${order.createTime}</td>
                    <td>
                        <div class="table-actions">
                            <button class="btn-action" onclick="window.location.href='order-detail.html'">æŸ¥çœ‹</button>
                            <button class="btn-action">${order.status === 'completed' ? 'ä¸‹è½½æŠ¥å‘Š' : 'ç¼–è¾‘'}</button>
                        </div>
                    </td>
                `
          tbody.appendChild(tr)
        })

        // æ›´æ–°åˆ†é¡µä¿¡æ¯
        updatePagination()
      }

      // æ›´æ–°åˆ†é¡µæ§ä»¶
      function updatePagination() {
        totalPages = Math.ceil(filteredOrders.length / pageSize)
        const startRecord =
          filteredOrders.length === 0 ? 0 : (currentPage - 1) * pageSize + 1
        const endRecord = Math.min(
          currentPage * pageSize,
          filteredOrders.length
        )

        // æ›´æ–°è®°å½•ä¿¡æ¯
        document.getElementById('startRecord').textContent = startRecord
        document.getElementById('endRecord').textContent = endRecord
        document.getElementById('totalRecords').textContent =
          filteredOrders.length

        // æ›´æ–°é¡µç æŒ‰é’®
        const pageNumbers = document.getElementById('pageNumbers')
        pageNumbers.innerHTML = ''

        // è®¡ç®—æ˜¾ç¤ºçš„é¡µç èŒƒå›´
        let startPage = Math.max(1, currentPage - 2)
        let endPage = Math.min(totalPages, currentPage + 2)

        // è°ƒæ•´èŒƒå›´ä»¥å§‹ç»ˆæ˜¾ç¤º5ä¸ªé¡µç ï¼ˆå¦‚æœå¯èƒ½ï¼‰
        if (endPage - startPage < 4) {
          if (startPage === 1) {
            endPage = Math.min(totalPages, 5)
          } else if (endPage === totalPages) {
            startPage = Math.max(1, totalPages - 4)
          }
        }

        // ç”Ÿæˆé¡µç æŒ‰é’®
        for (let i = startPage; i <= endPage; i++) {
          const btn = document.createElement('button')
          btn.className = 'page-btn'
          btn.textContent = i
          btn.onclick = () => goToPage(i)
          if (i === currentPage) {
            btn.classList.add('active')
          }
          pageNumbers.appendChild(btn)
        }

        // æ›´æ–°å¯¼èˆªæŒ‰é’®çŠ¶æ€
        document.getElementById('firstPageBtn').disabled = currentPage === 1
        document.getElementById('prevPageBtn').disabled = currentPage === 1
        document.getElementById('nextPageBtn').disabled =
          currentPage === totalPages || totalPages === 0
        document.getElementById('lastPageBtn').disabled =
          currentPage === totalPages || totalPages === 0

        // æ˜¾ç¤º/éšè—é¦–é¡µå’Œæœ«é¡µæŒ‰é’®
        document.getElementById('firstPageBtn').style.display =
          totalPages > 5 ? 'flex' : 'none'
        document.getElementById('lastPageBtn').style.display =
          totalPages > 5 ? 'flex' : 'none'
      }

      // è·³è½¬åˆ°æŒ‡å®šé¡µ
      function goToPage(page) {
        if (page < 1 || page > totalPages) return
        currentPage = page
        renderTable()
      }

      // ä¸Šä¸€é¡µ
      function previousPage() {
        if (currentPage > 1) {
          currentPage--
          renderTable()
        }
      }

      // ä¸‹ä¸€é¡µ
      function nextPage() {
        if (currentPage < totalPages) {
          currentPage++
          renderTable()
        }
      }

      // è·³è½¬é¡µé¢
      function jumpToPage() {
        const input = document.getElementById('pageJumpInput')
        const page = parseInt(input.value)
        if (page && page >= 1 && page <= totalPages) {
          goToPage(page)
          input.value = ''
        } else {
          alert(`è¯·è¾“å…¥1åˆ°${totalPages}ä¹‹é—´çš„é¡µç `)
        }
      }

      // æ‰§è¡Œæœç´¢
      function performSearch() {
        showLoading()

        // è·å–æœç´¢æ¡ä»¶
        const projectId = document
          .getElementById('projectIdSearch')
          .value.trim()
        const customerName = document
          .getElementById('customerNameSearch')
          .value.trim()
          .toLowerCase()
        const status = document.getElementById('statusFilter').value

        // è¿‡æ»¤æ•°æ®
        filteredOrders = allOrders.filter(order => {
          // é¡¹ç›®ç¼–å·ç²¾ç¡®åŒ¹é…
          if (projectId && order.projectId !== projectId) {
            return false
          }

          // å®¢æˆ·åç§°æ¨¡ç³ŠåŒ¹é…
          if (
            customerName &&
            !order.customerName.toLowerCase().includes(customerName)
          ) {
            return false
          }

          // çŠ¶æ€ç­›é€‰
          if (status && order.status !== status) {
            return false
          }

          return true
        })

        // é‡ç½®åˆ°ç¬¬ä¸€é¡µ
        currentPage = 1

        // æ¨¡æ‹ŸåŠ è½½å»¶è¿Ÿ
        setTimeout(() => {
          hideLoading()
          renderTable()
        }, 300)
      }

      // æ¸…ç©ºæœç´¢æ¡†
      function clearSearch(inputId) {
        document.getElementById(inputId).value = ''
        updateSearchBoxState(inputId)
        performSearch()
      }

      // æ›´æ–°æœç´¢æ¡†çŠ¶æ€
      function updateSearchBoxState(inputId) {
        const input = document.getElementById(inputId)
        const searchBox = input.closest('.search-box')
        if (input.value) {
          searchBox.classList.add('has-value')
        } else {
          searchBox.classList.remove('has-value')
        }
      }

      // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
      function showLoading() {
        document.getElementById('loadingOverlay').classList.add('active')
      }

      // éšè—åŠ è½½çŠ¶æ€
      function hideLoading() {
        document.getElementById('loadingOverlay').classList.remove('active')
      }

      // é˜²æŠ–å‡½æ•°
      function debounce(func, wait) {
        return function executedFunction(...args) {
          const later = () => {
            clearTimeout(searchTimer)
            func(...args)
          }
          clearTimeout(searchTimer)
          searchTimer = setTimeout(later, wait)
        }
      }

      // é¡µé¢åˆå§‹åŒ–
      document.addEventListener('DOMContentLoaded', () => {
        // è®¾ç½®é¡µé¢æ ‡é¢˜
        if (window.limsNav) {
          window.limsNav.setPageTitle('é”€å”®å·¥ä½œå°')
        }

        // åˆå§‹åŒ–æ•°æ®
        initOrderData()
        renderTable()

        // ç»‘å®šæœç´¢æ¡†äº‹ä»¶
        const projectIdInput = document.getElementById('projectIdSearch')
        const customerNameInput = document.getElementById('customerNameSearch')

        // å®æ—¶æœç´¢ï¼ˆé˜²æŠ–å¤„ç†ï¼‰
        const debouncedSearch = debounce(performSearch, 500)

        projectIdInput.addEventListener('input', function () {
          updateSearchBoxState('projectIdSearch')
          debouncedSearch()
        })

        customerNameInput.addEventListener('input', function () {
          updateSearchBoxState('customerNameSearch')
          debouncedSearch()
        })

        // çŠ¶æ€ç­›é€‰å˜åŒ–æ—¶ç«‹å³æœç´¢
        document
          .getElementById('statusFilter')
          .addEventListener('change', performSearch)

        // å›è½¦é”®è§¦å‘æœç´¢
        projectIdInput.addEventListener('keypress', function (e) {
          if (e.key === 'Enter') {
            performSearch()
          }
        })

        customerNameInput.addEventListener('keypress', function (e) {
          if (e.key === 'Enter') {
            performSearch()
          }
        })

        // è·³è½¬è¾“å…¥æ¡†å›è½¦äº‹ä»¶
        document
          .getElementById('pageJumpInput')
          .addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
              jumpToPage()
            }
          })
      })
    </script>
  </body>
</html>
