<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>报告审批详情 - LIMS-XW</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family:
          -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC',
          'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
        background: #f5f7fa;
        min-height: 100vh;
        margin: 0;
      }

      /* 主内容区 */
      .main-content {
        padding: 20px;
        max-width: 1400px;
        margin: 0 auto;
      }

      /* 页面标题 */
      .page-header {
        margin-bottom: 24px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .page-title-section {
        flex: 1;
      }

      .page-title {
        font-size: 28px;
        color: #1f2937;
        font-weight: bold;
        margin-bottom: 8px;
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .report-number {
        color: #667eea;
      }

      .report-status {
        display: inline-block;
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: bold;
      }

      .report-status.pending {
        background: #fef3c7;
        color: #f59e0b;
      }

      .report-status.approved {
        background: #d1fae5;
        color: #10b981;
      }

      .report-status.rejected {
        background: #fee2e2;
        color: #ef4444;
      }

      .urgent-badge {
        display: inline-block;
        padding: 4px 12px;
        background: #ef4444;
        color: white;
        border-radius: 20px;
        font-size: 14px;
        font-weight: bold;
      }

      .breadcrumb {
        color: #6b7280;
        font-size: 14px;
      }

      .breadcrumb a {
        color: #667eea;
        text-decoration: none;
      }

      .page-actions {
        display: flex;
        gap: 12px;
      }

      .btn {
        padding: 10px 20px;
        border-radius: 6px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
        border: none;
      }

      .btn-success {
        background: linear-gradient(135deg, #34d399 0%, #10b981 100%);
        color: white;
      }

      .btn-danger {
        background: #ef4444;
        color: white;
      }

      .btn-secondary {
        background: white;
        color: #6b7280;
        border: 1px solid #e5e7eb;
      }

      .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
      }

      .btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      }

      /* 内容布局 */
      .content-layout {
        display: grid;
        grid-template-columns: 1fr 380px;
        gap: 20px;
      }

      .main-info {
        display: flex;
        flex-direction: column;
        gap: 20px;
      }

      .info-card {
        background: white;
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }

      .card-header {
        font-size: 18px;
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 20px;
        padding-bottom: 12px;
        border-bottom: 1px solid #e5e7eb;
      }

      .info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 16px;
      }

      .info-item {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }

      .info-label {
        font-size: 12px;
        color: #6b7280;
      }

      .info-value {
        font-size: 14px;
        color: #1f2937;
        font-weight: 500;
      }

      /* 人员信息 */
      .staff-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 16px;
      }

      .staff-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px;
        background: #f9fafb;
        border-radius: 8px;
      }

      .staff-avatar {
        width: 40px;
        height: 40px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 16px;
        font-weight: bold;
      }

      .staff-info {
        flex: 1;
      }

      .staff-name {
        font-size: 14px;
        font-weight: 600;
        color: #1f2937;
      }

      .staff-role {
        font-size: 12px;
        color: #6b7280;
      }

      /* 报告预览 */
      .report-preview {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        text-align: center;
        padding: 60px 20px;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.2s;
        position: relative;
        overflow: hidden;
      }

      .report-preview::before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(
          circle,
          rgba(255, 255, 255, 0.1) 0%,
          transparent 70%
        );
        opacity: 0;
        transition: opacity 0.3s;
      }

      .report-preview:hover::before {
        opacity: 1;
      }

      .report-preview:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
      }

      .preview-icon {
        width: 80px;
        height: 80px;
        margin: 0 auto 20px auto;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 36px;
      }

      .preview-title {
        font-size: 20px;
        font-weight: 600;
        margin-bottom: 8px;
      }

      .preview-desc {
        font-size: 14px;
        opacity: 0.9;
        margin-bottom: 16px;
      }

      .preview-info {
        font-size: 12px;
        opacity: 0.8;
      }

      /* 审批操作 */
      .approval-actions {
        display: flex;
        gap: 12px;
        margin-top: 20px;
      }

      .approval-btn {
        flex: 1;
        padding: 16px;
        border: none;
        border-radius: 12px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
      }

      .approve-btn {
        background: linear-gradient(135deg, #34d399 0%, #10b981 100%);
        color: white;
      }

      .reject-btn {
        background: linear-gradient(135deg, #f87171 0%, #ef4444 100%);
        color: white;
      }

      .approval-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      }

      /* 侧边栏 */
      .side-info {
        display: flex;
        flex-direction: column;
        gap: 20px;
      }

      .status-card {
        background: white;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }

      .status-indicator {
        padding: 20px;
        border-radius: 8px;
        text-align: center;
        margin-bottom: 16px;
      }

      .status-indicator.pending {
        background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
      }

      .status-indicator.approved {
        background: linear-gradient(135deg, #34d399 0%, #10b981 100%);
      }

      .status-indicator.rejected {
        background: linear-gradient(135deg, #f87171 0%, #ef4444 100%);
      }

      .status-text {
        color: white;
        font-size: 18px;
        font-weight: 600;
      }

      .status-details {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .status-detail-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .status-detail-label {
        font-size: 14px;
        color: #6b7280;
      }

      .status-detail-value {
        font-size: 14px;
        font-weight: 500;
        color: #1f2937;
      }

      /* 弹窗样式 */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
      }

      .modal-content {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        border-radius: 12px;
        padding: 24px;
        max-width: 500px;
        width: 90%;
      }

      .modal-header {
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 16px;
      }

      .modal-body {
        margin-bottom: 20px;
      }

      .modal-textarea {
        width: 100%;
        min-height: 100px;
        padding: 12px;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        font-size: 14px;
        resize: vertical;
      }

      .modal-footer {
        display: flex;
        gap: 12px;
        justify-content: flex-end;
      }

      /* 报告预览弹窗 */
      .report-modal .modal-content {
        max-width: 90%;
        max-height: 90%;
        overflow-y: auto;
      }

      .report-document {
        padding: 40px;
        background: white;
        font-family: 'SimSun', serif;
        line-height: 1.6;
      }

      .document-title {
        text-align: center;
        font-size: 24px;
        font-weight: bold;
        margin-bottom: 30px;
        color: #1f2937;
      }

      .document-section {
        margin-bottom: 24px;
      }

      .section-title {
        font-size: 16px;
        font-weight: bold;
        margin-bottom: 12px;
        color: #1f2937;
      }

      .document-content {
        font-size: 14px;
        color: #374151;
      }

      /* 响应式设计 */
      @media (max-width: 768px) {
        .content-layout {
          grid-template-columns: 1fr;
        }

        .info-grid,
        .staff-grid {
          grid-template-columns: 1fr;
        }

        .approval-actions {
          flex-direction: column;
        }

        .page-actions {
          flex-direction: column;
          gap: 8px;
        }

        .btn {
          width: 100%;
        }

        .modal-content {
          width: 95%;
          padding: 20px;
        }

        .report-document {
          padding: 20px;
        }
      }
    </style>
  </head>
  <body>
    <script src="navigation.js"></script>

    <!-- 主内容 -->
    <div class="main-content">
      <!-- 页面头部 -->
      <div class="page-header">
        <div class="page-title-section">
          <h2 class="page-title">
            <span class="report-number">XW250903-090-RPT-091</span>
            <span class="report-status pending" id="report-status">待审批</span>
            <span class="urgent-badge">加急</span>
          </h2>
          <div class="breadcrumb">
            <a href="approval-workspace.html" id="breadcrumb-back"
              >报告审批工作台</a
            >
            / 审批详情
          </div>
        </div>
        <div class="page-actions" id="page-actions">
          <button class="btn btn-secondary">下载报告</button>
          <button class="btn-danger btn" onclick="rejectReport()">
            审批驳回
          </button>
          <button class="btn btn-success" onclick="approveReport()">
            审批通过
          </button>
        </div>
      </div>

      <!-- 内容布局 -->
      <div class="content-layout">
        <!-- 左侧主信息区 -->
        <div class="main-info">
          <!-- 客户信息 -->
          <div class="info-card">
            <div class="card-header">客户信息</div>
            <div class="info-grid">
              <div class="info-item">
                <span class="info-label">客户名称</span>
                <span class="info-value">广州环保科技有限公司</span>
              </div>
              <div class="info-item">
                <span class="info-label">客户联系人</span>
                <span class="info-value">王经理</span>
              </div>
              <div class="info-item">
                <span class="info-label">客户联系电话</span>
                <span class="info-value">13800138001</span>
              </div>
              <div class="info-item">
                <span class="info-label">受检单位</span>
                <span class="info-value">广州环保科技总部</span>
              </div>
              <div class="info-item">
                <span class="info-label">受检单位地址</span>
                <span class="info-value">广州市天河区科技园A栋3楼</span>
              </div>
              <div class="info-item">
                <span class="info-label">检测类型</span>
                <span
                  class="info-value"
                  style="color: #059669; font-weight: 600"
                  >50325-2020</span
                >
              </div>
            </div>
          </div>

          <!-- 参与员工信息 -->
          <div class="info-card">
            <div class="card-header">参与员工信息</div>
            <div class="staff-grid">
              <div class="staff-item">
                <div class="staff-avatar">张</div>
                <div class="staff-info">
                  <div class="staff-name">张三</div>
                  <div class="staff-role">销售人员</div>
                </div>
              </div>
              <div class="staff-item">
                <div class="staff-avatar">赵</div>
                <div class="staff-info">
                  <div class="staff-name">赵六</div>
                  <div class="staff-role">采样人员</div>
                </div>
              </div>
              <div class="staff-item">
                <div class="staff-avatar">李</div>
                <div class="staff-info">
                  <div class="staff-name">李七</div>
                  <div class="staff-role">样品管理员</div>
                </div>
              </div>
              <div class="staff-item">
                <div class="staff-avatar">王</div>
                <div class="staff-info">
                  <div class="staff-name">王八</div>
                  <div class="staff-role">实验室管理员</div>
                </div>
              </div>
              <div class="staff-item">
                <div class="staff-avatar">孙</div>
                <div class="staff-info">
                  <div class="staff-name">孙九</div>
                  <div class="staff-role">检测人员</div>
                </div>
              </div>
              <div class="staff-item">
                <div class="staff-avatar">周</div>
                <div class="staff-info">
                  <div class="staff-name">周十</div>
                  <div class="staff-role">报告编制员</div>
                </div>
              </div>
            </div>
          </div>

          <!-- 报告预览 -->
          <div class="info-card">
            <div class="card-header">检测报告预览</div>
            <div class="report-preview" onclick="showReportPreview()">
              <div class="preview-icon">
                <svg
                  width="40"
                  height="40"
                  viewBox="0 0 24 24"
                  fill="currentColor"
                >
                  <path
                    d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"
                  />
                </svg>
              </div>
              <div class="preview-title">GB 50325-2020 检测报告</div>
              <div class="preview-desc">点击查看完整报告内容</div>
              <div class="preview-info">
                报告编号：XW250903-090-RPT-091<br />
                生成时间：2025-09-05 09:30<br />
                页数：8页 | 大小：2.5MB
              </div>
            </div>
          </div>

          <!-- 审批操作 -->
          <div class="approval-actions" id="approval-actions">
            <button class="approval-btn approve-btn" onclick="approveReport()">
              <svg
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="currentColor"
                style="margin-right: 8px"
              >
                <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" />
              </svg>
              审批通过
            </button>
            <button class="approval-btn reject-btn" onclick="rejectReport()">
              <svg
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="currentColor"
                style="margin-right: 8px"
              >
                <path
                  d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"
                />
              </svg>
              审批驳回
            </button>
          </div>
        </div>

        <!-- 右侧状态区 -->
        <div class="side-info">
          <!-- 报告状态 -->
          <div class="status-card">
            <div class="status-indicator pending" id="status-indicator">
              <div class="status-text" id="status-text">待审批</div>
            </div>
            <div class="status-details">
              <div class="status-detail-item">
                <span class="status-detail-label">报告类型</span>
                <span class="status-detail-value">50325-2020</span>
              </div>
              <div class="status-detail-item">
                <span class="status-detail-label">审核时间</span>
                <span class="status-detail-value">2025-09-05 09:30</span>
              </div>
              <div class="status-detail-item">
                <span class="status-detail-label">审核人员</span>
                <span class="status-detail-value">刘审核</span>
              </div>
              <div class="status-detail-item">
                <span class="status-detail-label">优先级</span>
                <span class="status-detail-value" style="color: #ef4444"
                  >加急</span
                >
              </div>
              <div class="status-detail-item">
                <span class="status-detail-label">预计交付</span>
                <span class="status-detail-value">2025-09-07</span>
              </div>
            </div>
          </div>

          <!-- 检测统计 -->
          <div class="status-card">
            <div class="card-header">检测统计</div>
            <div
              style="
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
              "
            >
              <div
                style="
                  background: #f9fafb;
                  padding: 16px;
                  border-radius: 8px;
                  text-align: center;
                "
              >
                <div style="font-size: 24px; font-weight: bold; color: #667eea">
                  12
                </div>
                <div style="font-size: 12px; color: #6b7280">检测点位</div>
              </div>
              <div
                style="
                  background: #f9fafb;
                  padding: 16px;
                  border-radius: 8px;
                  text-align: center;
                "
              >
                <div style="font-size: 24px; font-weight: bold; color: #10b981">
                  59
                </div>
                <div style="font-size: 12px; color: #6b7280">检测合格项</div>
              </div>
              <div
                style="
                  background: #f9fafb;
                  padding: 16px;
                  border-radius: 8px;
                  text-align: center;
                "
              >
                <div style="font-size: 24px; font-weight: bold; color: #ef4444">
                  1
                </div>
                <div style="font-size: 12px; color: #6b7280">不合格项</div>
              </div>
              <div
                style="
                  background: #f9fafb;
                  padding: 16px;
                  border-radius: 8px;
                  text-align: center;
                "
              >
                <div style="font-size: 24px; font-weight: bold; color: #f59e0b">
                  98.3%
                </div>
                <div style="font-size: 12px; color: #6b7280">合格率</div>
              </div>
            </div>
          </div>

          <!-- 审核历史 -->
          <div class="status-card">
            <div class="card-header">审批历史</div>
            <div style="display: flex; flex-direction: column; gap: 12px">
              <div
                style="
                  display: flex;
                  align-items: center;
                  gap: 12px;
                  padding: 12px;
                  background: #f9fafb;
                  border-radius: 6px;
                "
              >
                <div
                  style="
                    width: 8px;
                    height: 8px;
                    background: #10b981;
                    border-radius: 50%;
                  "
                ></div>
                <div style="flex: 1">
                  <div style="font-size: 13px; font-weight: 500">报告生成</div>
                  <div style="font-size: 11px; color: #6b7280">
                    2025-09-04 14:30
                  </div>
                </div>
              </div>
              <div
                style="
                  display: flex;
                  align-items: center;
                  gap: 12px;
                  padding: 12px;
                  background: #d1fae5;
                  border-radius: 6px;
                "
              >
                <div
                  style="
                    width: 8px;
                    height: 8px;
                    background: #10b981;
                    border-radius: 50%;
                  "
                ></div>
                <div style="flex: 1">
                  <div style="font-size: 13px; font-weight: 500">审核通过</div>
                  <div style="font-size: 11px; color: #6b7280">
                    2025-09-05 09:30
                  </div>
                </div>
              </div>
              <div
                style="
                  display: flex;
                  align-items: center;
                  gap: 12px;
                  padding: 12px;
                  background: #fef3c7;
                  border-radius: 6px;
                "
              >
                <div
                  style="
                    width: 8px;
                    height: 8px;
                    background: #f59e0b;
                    border-radius: 50%;
                  "
                ></div>
                <div style="flex: 1">
                  <div style="font-size: 13px; font-weight: 500">等待审批</div>
                  <div style="font-size: 11px; color: #6b7280">当前状态</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 审批驳回弹窗 -->
    <div id="reject-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">审批驳回原因</div>
        <div class="modal-body">
          <textarea
            id="reject-reason"
            class="modal-textarea"
            placeholder="请输入审批驳回的具体原因，以便相关人员了解和改进..."
          ></textarea>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" onclick="hideRejectModal()">
            取消
          </button>
          <button class="btn-danger btn" onclick="confirmReject()">
            确认驳回
          </button>
        </div>
      </div>
    </div>

    <!-- 报告预览弹窗 -->
    <div id="report-modal" class="report-modal modal">
      <div class="modal-content">
        <div class="modal-header">
          <span>检测报告预览</span>
          <button
            style="
              float: right;
              border: none;
              background: none;
              font-size: 18px;
              cursor: pointer;
            "
            onclick="hideReportModal()"
          >
            ×
          </button>
        </div>
        <div class="modal-body">
          <div class="report-document">
            <div class="document-title">GB 50325-2020 检测报告</div>

            <div class="document-section">
              <div class="section-title">一、基本信息</div>
              <div class="document-content">
                <p><strong>委托单位：</strong>广州环保科技有限公司</p>
                <p><strong>受检单位：</strong>广州环保科技总部</p>
                <p><strong>受检地址：</strong>广州市天河区科技园A栋3楼</p>
                <p><strong>检测类别：</strong>委托检测（采样）</p>
                <p><strong>检测范围：</strong>GB 50325-2020 检测</p>
                <p><strong>采样日期：</strong>2025年9月2日</p>
                <p><strong>检测日期：</strong>2025年9月3日至2025年9月4日</p>
              </div>
            </div>

            <div class="document-section">
              <div class="section-title">二、检测项目及依据</div>
              <div class="document-content">
                <p>
                  <strong>检测内容：</strong
                  >三苯五项：甲醛、苯、甲苯、二甲苯、TVOC
                </p>
                <p>
                  <strong>检测依据：</strong>GB
                  50325-2020《民用建筑工程室内环境污染控制标准》
                </p>
              </div>
            </div>

            <div class="document-section">
              <div class="section-title">三、主要检测仪器</div>
              <div class="document-content">
                <p>气相色谱仪 GC-2030（岛津）</p>
                <p>分光光度计 UV-2600（岛津）</p>
                <p>空气采样器 QC-2A（青岛崂山）</p>
              </div>
            </div>

            <div class="document-section">
              <div class="section-title">四、检测结果</div>
              <div class="document-content">
                <p>
                  详细检测数据见附表。经检测，12个检测点位中，11个点位所有指标均符合GB
                  50325-2020标准要求，1个点位甲醛指标超标。
                </p>
              </div>
            </div>

            <div class="document-section">
              <div class="section-title">五、检测结论</div>
              <div class="document-content">
                <p>
                  根据检测结果，受检区域室内空气质量部分指标不符合GB
                  50325-2020《民用建筑工程室内环境污染控制标准》要求，建议采取相应措施改善室内空气质量。
                </p>
              </div>
            </div>

            <div style="margin-top: 40px; text-align: right">
              <p>检测机构：星旺检测技术有限公司</p>
              <p>报告日期：2025年9月5日</p>
              <p>报告编号：XW250903-090-RPT-091</p>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-primary" onclick="hideReportModal()">
            关闭
          </button>
        </div>
      </div>
    </div>

    <script>
      // 模拟当前用户角色和报告状态
      const currentUserRole =
        sessionStorage.getItem('role') || 'report_approver'
      let reportStatus = 'pending' // pending, approved, rejected

      // 设置页面标题
      document.addEventListener('DOMContentLoaded', () => {
        if (window.limsNav) {
          window.limsNav.setPageTitle('报告审批详情')
        }
        updatePageActions()

        // 确保角色正确设置（如果未设置，使用默认值）
        if (!sessionStorage.getItem('role')) {
          sessionStorage.setItem('role', 'report_approver')
        }

        // 动态更新面包屑链接（确保与导航栏返回按钮行为一致）
        const breadcrumbLink = document.getElementById('breadcrumb-back')
        if (breadcrumbLink && window.limsNav) {
          const targetWorkspace =
            window.limsNav.roleWorkspaceMap['report_approver']
          if (targetWorkspace) {
            breadcrumbLink.href = targetWorkspace
          }
        }
      })

      // 更新页面操作按钮
      function updatePageActions() {
        const pageActions = document.getElementById('page-actions')
        const approvalActions = document.getElementById('approval-actions')

        if (reportStatus === 'approved') {
          pageActions.innerHTML =
            '<button class="btn btn-secondary">下载报告</button><button class="btn btn-primary">发送客户</button>'
          approvalActions.style.display = 'none'
        } else if (reportStatus === 'rejected') {
          pageActions.innerHTML =
            '<button class="btn btn-secondary">下载报告</button><button class="btn btn-primary">查看处理历史</button>'
          approvalActions.style.display = 'none'
        }
      }

      // 审批通过
      function approveReport() {
        if (confirm('确定审批通过吗？通过后报告将可以正式交付给客户。')) {
          reportStatus = 'approved'

          // 更新状态显示
          document.getElementById('report-status').textContent = '审批通过'
          document.getElementById('report-status').className =
            'report-status approved'
          document.getElementById('status-text').textContent = '审批通过'
          document.getElementById('status-indicator').className =
            'status-indicator approved'

          // 更新状态详情
          const statusDetails = document.querySelector('.status-details')
          statusDetails.innerHTML = `
                    <div class="status-detail-item">
                        <span class="status-detail-label">报告类型</span>
                        <span class="status-detail-value">室内空气质量检测</span>
                    </div>
                    <div class="status-detail-item">
                        <span class="status-detail-label">审批时间</span>
                        <span class="status-detail-value">${new Date().toLocaleString('zh-CN')}</span>
                    </div>
                    <div class="status-detail-item">
                        <span class="status-detail-label">审批人员</span>
                        <span class="status-detail-value">${sessionStorage.getItem('username') || '审批员'}</span>
                    </div>
                    <div class="status-detail-item">
                        <span class="status-detail-label">状态</span>
                        <span class="status-detail-value" style="color: #10b981;">已通过</span>
                    </div>
                `

          updatePageActions()
          alert('报告审批通过！系统将自动通知客户并安排报告正式交付。')
        }
      }

      // 显示审批驳回弹窗
      function rejectReport() {
        document.getElementById('reject-modal').style.display = 'block'
      }

      // 隐藏审批驳回弹窗
      function hideRejectModal() {
        document.getElementById('reject-modal').style.display = 'none'
        document.getElementById('reject-reason').value = ''
      }

      // 确认审批驳回
      function confirmReject() {
        const reason = document.getElementById('reject-reason').value.trim()
        if (!reason) {
          alert('请输入审批驳回的原因')
          return
        }

        if (confirm('确定审批驳回吗？报告将回到审核流程进行重新处理。')) {
          reportStatus = 'rejected'

          // 更新状态显示
          document.getElementById('report-status').textContent = '审批驳回'
          document.getElementById('report-status').className =
            'report-status rejected'
          document.getElementById('status-text').textContent = '审批驳回'
          document.getElementById('status-indicator').className =
            'status-indicator rejected'

          // 更新状态详情
          const statusDetails = document.querySelector('.status-details')
          statusDetails.innerHTML = `
                    <div class="status-detail-item">
                        <span class="status-detail-label">报告类型</span>
                        <span class="status-detail-value">室内空气质量检测</span>
                    </div>
                    <div class="status-detail-item">
                        <span class="status-detail-label">审批时间</span>
                        <span class="status-detail-value">${new Date().toLocaleString('zh-CN')}</span>
                    </div>
                    <div class="status-detail-item">
                        <span class="status-detail-label">审批人员</span>
                        <span class="status-detail-value">${sessionStorage.getItem('username') || '审批员'}</span>
                    </div>
                    <div class="status-detail-item">
                        <span class="status-detail-label">驳回原因</span>
                        <span class="status-detail-value" style="color: #ef4444;">${reason}</span>
                    </div>
                `

          hideRejectModal()
          updatePageActions()
          alert('报告审批驳回！系统已通知相关人员进行重新处理。')
        }
      }

      // 显示报告预览
      function showReportPreview() {
        document.getElementById('report-modal').style.display = 'block'
      }

      // 隐藏报告预览
      function hideReportModal() {
        document.getElementById('report-modal').style.display = 'none'
      }

      // 点击弹窗外部关闭
      window.addEventListener('click', function (event) {
        if (event.target.classList.contains('modal')) {
          event.target.style.display = 'none'
        }
      })

      // 页面加载动画
      window.addEventListener('load', function () {
        const cards = document.querySelectorAll('.info-card, .status-card')
        cards.forEach((card, index) => {
          card.style.opacity = '0'
          card.style.transform = 'translateY(20px)'
          setTimeout(() => {
            card.style.transition = 'all 0.3s ease'
            card.style.opacity = '1'
            card.style.transform = 'translateY(0)'
          }, index * 100)
        })
      })
    </script>
  </body>
</html>
