<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æ£€æµ‹ä»»åŠ¡è¯¦æƒ… - LIMS-XWç³»ç»Ÿ</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family:
          -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC',
          'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
        background: #f5f7fa;
        min-height: 100vh;
        margin: 0;
      }

      /* ä¸»å†…å®¹åŒº */
      .main-content {
        padding: 20px;
        max-width: 1400px;
        margin: 0 auto;
      }

      /* é¡µé¢æ ‡é¢˜ */
      .page-header {
        margin-bottom: 24px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .page-title-section {
        flex: 1;
      }

      .page-title {
        font-size: 28px;
        color: #1f2937;
        font-weight: bold;
        margin-bottom: 8px;
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .project-number {
        color: #667eea;
      }

      .task-status {
        display: inline-block;
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: bold;
      }

      .task-status.pending {
        background: #dbeafe;
        color: #3b82f6;
      }

      .task-status.testing {
        background: #e0e7ff;
        color: #8b5cf6;
      }

      .task-status.completed {
        background: #d1fae5;
        color: #10b981;
      }

      .breadcrumb {
        color: #6b7280;
        font-size: 14px;
      }

      .breadcrumb a {
        color: #667eea;
        text-decoration: none;
      }

      .page-actions {
        display: flex;
        gap: 12px;
      }

      .btn {
        padding: 10px 20px;
        border-radius: 6px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
        border: none;
      }

      .btn-primary {
        background: linear-gradient(135deg, #34d399 0%, #10b981 100%);
        color: white;
      }

      .btn-primary:hover {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
      }

      .btn-secondary {
        background: #f3f4f6;
        color: #4b5563;
      }

      .btn-secondary:hover {
        background: #e5e7eb;
      }

      .btn-warning {
        background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
        color: white;
      }

      .btn-warning:hover {
        background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
      }

      .btn:disabled {
        background: #9ca3af;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }

      /* å†…å®¹å¸ƒå±€ */
      .content-layout {
        display: grid;
        grid-template-columns: 1fr 380px;
        gap: 20px;
      }

      .main-info {
        display: flex;
        flex-direction: column;
        gap: 20px;
      }

      .info-card {
        background: white;
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }

      .card-header {
        font-size: 18px;
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 20px;
        padding-bottom: 12px;
        border-bottom: 1px solid #e5e7eb;
      }

      .info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 16px;
      }

      .info-item {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }

      .info-label {
        font-size: 12px;
        color: #6b7280;
      }

      .info-value {
        font-size: 14px;
        color: #1f2937;
        font-weight: 500;
      }

      /* æ ·å“å¡ç‰‡ */
      .sample-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 16px;
      }

      .sample-card {
        background: #f9fafb;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        padding: 16px;
      }

      .sample-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
      }

      .sample-id {
        font-size: 14px;
        font-weight: 600;
        color: #667eea;
      }

      .sample-status {
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 500;
      }

      .sample-status.good {
        background: #d1fae5;
        color: #10b981;
      }

      .sample-status.damaged {
        background: #fee2e2;
        color: #ef4444;
      }

      .sample-location {
        font-size: 13px;
        color: #1f2937;
        margin-bottom: 4px;
      }

      .sample-details {
        font-size: 12px;
        color: #6b7280;
      }

      /* ä¾§è¾¹æ  */
      .side-info {
        display: flex;
        flex-direction: column;
        gap: 20px;
      }

      .status-card {
        background: white;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }

      .status-indicator {
        padding: 20px;
        border-radius: 8px;
        text-align: center;
        margin-bottom: 16px;
      }

      .status-indicator.pending {
        background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%);
      }

      .status-indicator.testing {
        background: linear-gradient(135deg, #a78bfa 0%, #8b5cf6 100%);
      }

      .status-indicator.completed {
        background: linear-gradient(135deg, #34d399 0%, #10b981 100%);
      }

      .status-text {
        color: white;
        font-size: 18px;
        font-weight: 600;
      }

      .status-details {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .status-detail-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .status-detail-label {
        font-size: 14px;
        color: #6b7280;
      }

      .status-detail-value {
        font-size: 14px;
        font-weight: 500;
        color: #1f2937;
      }

      /* æ“ä½œæŒ‰é’®åŒº */
      .action-section {
        background: white;
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }

      .action-buttons {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .action-btn {
        padding: 16px 24px;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
      }

      .action-btn.start-btn {
        background: linear-gradient(135deg, #34d399 0%, #10b981 100%);
        color: white;
      }

      .action-btn.start-btn:hover {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(16, 185, 129, 0.3);
      }

      .action-btn.complete-btn {
        background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
        color: white;
      }

      .action-btn.complete-btn:hover {
        background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(245, 158, 11, 0.3);
      }

      .action-btn:disabled {
        background: #9ca3af;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }

      .action-note {
        margin-top: 16px;
        padding: 12px;
        background: #f0f9ff;
        border-radius: 6px;
        font-size: 13px;
        color: #1e40af;
      }

      /* è¿›åº¦æ¡ */
      .progress-section {
        background: white;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }

      .progress-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
      }

      .progress-title {
        font-size: 16px;
        font-weight: 600;
        color: #1f2937;
      }

      .progress-percentage {
        font-size: 18px;
        font-weight: bold;
        color: #667eea;
      }

      .progress-bar {
        height: 8px;
        background: #e5e7eb;
        border-radius: 4px;
        overflow: hidden;
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 4px;
        transition: width 0.3s ease;
      }

      .progress-details {
        margin-top: 12px;
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 16px;
      }

      .progress-item {
        text-align: center;
        padding: 12px;
        background: #f9fafb;
        border-radius: 6px;
      }

      .progress-item-value {
        font-size: 16px;
        font-weight: bold;
        color: #1f2937;
      }

      .progress-item-label {
        font-size: 12px;
        color: #6b7280;
        margin-top: 4px;
      }

      /* å®ŒæˆçŠ¶æ€ç‰¹æœ‰æ ·å¼ */
      .completion-section {
        background: #f0f9ff;
        border-radius: 12px;
        padding: 24px;
        margin-top: 20px;
        border: 2px solid #0ea5e9;
      }

      .data-access-buttons {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 16px;
        margin-top: 20px;
      }

      .data-btn {
        padding: 16px;
        background: white;
        border: 2px solid #e5e7eb;
        border-radius: 12px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        color: #374151;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
      }

      .data-btn:hover {
        border-color: #667eea;
        background: #f8fafc;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      .data-btn-icon {
        font-size: 24px;
        margin-bottom: 4px;
      }

      .data-btn-title {
        font-weight: 600;
        font-size: 14px;
      }

      .data-btn-desc {
        font-size: 12px;
        color: #6b7280;
      }

      /* å“åº”å¼è®¾è®¡ */
      @media (max-width: 768px) {
        .content-layout {
          grid-template-columns: 1fr;
        }

        .info-grid {
          grid-template-columns: 1fr;
        }

        .sample-grid {
          grid-template-columns: 1fr;
        }

        .page-actions {
          flex-direction: column;
          gap: 8px;
        }

        .btn {
          width: 100%;
        }
      }
    </style>
  </head>
  <body>
    <script src="navigation.js"></script>

    <!-- ä¸»å†…å®¹ -->
    <div class="main-content">
      <!-- é¡µé¢å¤´éƒ¨ -->
      <div class="page-header">
        <div class="page-title-section">
          <div class="breadcrumb">
            <a href="staff-tasks.html">æˆ‘çš„ä»»åŠ¡</a> / ä»»åŠ¡è¯¦æƒ…
          </div>
          <h2 class="page-title">
            <span class="project-number">XW250903-100</span>
            <span class="task-status pending">å¾…æ£€æµ‹</span>
          </h2>
        </div>
        <div class="page-actions" id="page-actions">
          <button class="btn btn-secondary" onclick="exportTaskInfo()">
            å¯¼å‡ºä¿¡æ¯
          </button>
        </div>
      </div>

      <!-- å†…å®¹å¸ƒå±€ -->
      <div class="content-layout">
        <!-- å·¦ä¾§ä¸»ä¿¡æ¯åŒº -->
        <div class="main-info">
          <!-- åŸºæœ¬ä¿¡æ¯ -->
          <div class="info-card">
            <div class="card-header">åŸºæœ¬ä¿¡æ¯</div>
            <div class="info-grid">
              <div class="info-item">
                <span class="info-label">å®¢æˆ·åç§°</span>
                <span class="info-value">å¹¿å·ç¯ä¿ç§‘æŠ€æœ‰é™å…¬å¸</span>
              </div>
              <div class="info-item">
                <span class="info-label">å—æ£€å•ä½</span>
                <span class="info-value">å¹¿å·ç¯ä¿ç§‘æŠ€æ€»éƒ¨</span>
              </div>
              <div class="info-item">
                <span class="info-label">é‡‡æ ·åœ°å€</span>
                <span class="info-value">å¹¿å·å¸‚å¤©æ²³åŒºç§‘æŠ€å›­Aæ ‹3æ¥¼</span>
              </div>
              <div class="info-item">
                <span class="info-label">é”€å”®äººå‘˜</span>
                <span class="info-value">å¼ ä¸‰</span>
              </div>
              <div class="info-item">
                <span class="info-label">é‡‡æ ·äººå‘˜</span>
                <span class="info-value">èµµå…­</span>
              </div>
              <div class="info-item">
                <span class="info-label">æ ·å“ç®¡ç†å‘˜</span>
                <span class="info-value">æä¸ƒ</span>
              </div>
            </div>
          </div>

          <!-- æ£€æµ‹ä¿¡æ¯ -->
          <div class="info-card">
            <div class="card-header">æ£€æµ‹ä¿¡æ¯</div>
            <div class="info-grid">
              <div class="info-item">
                <span class="info-label">æ£€æµ‹ç±»å‹</span>
                <span
                  class="info-value"
                  style="color: #059669; font-weight: 600"
                  >50325-2020</span
                >
              </div>
              <div class="info-item">
                <span class="info-label">æ£€æµ‹å†…å®¹</span>
                <span
                  class="info-value"
                  style="color: #059669; font-weight: 500"
                  >ä¸‰è‹¯äº”é¡¹ï¼šç”²é†›ã€è‹¯ã€ç”²è‹¯ã€äºŒç”²è‹¯ã€TVOC</span
                >
              </div>
              <div class="info-item">
                <span class="info-label">æ ·å“æ•°é‡</span>
                <span class="info-value">12ä¸ª</span>
              </div>
              <div class="info-item">
                <span class="info-label">å®Œå¥½æ ·å“</span>
                <span class="info-value" style="color: #10b981">11ä¸ª</span>
              </div>
              <div class="info-item">
                <span class="info-label">ç ´æŸæ ·å“</span>
                <span class="info-value" style="color: #ef4444">1ä¸ª</span>
              </div>
              <div class="info-item">
                <span class="info-label">æ¥æ”¶æ—¶é—´</span>
                <span class="info-value">2025-09-04 17:30</span>
              </div>
            </div>
          </div>

          <!-- æ ·å“åˆ—è¡¨ -->
          <div class="info-card">
            <div class="card-header">æ ·å“åˆ—è¡¨</div>
            <div class="sample-grid">
              <div class="sample-card">
                <div class="sample-header">
                  <span class="sample-id">XW250903-100-001</span>
                  <span class="sample-status good">å®Œå¥½</span>
                </div>
                <div class="sample-location">åŠå…¬å®¤AåŒºåŸŸ</div>
                <div class="sample-details">æ¥æ”¶æ—¶é—´ï¼š2025-09-04 17:30</div>
              </div>

              <div class="sample-card">
                <div class="sample-header">
                  <span class="sample-id">XW250903-100-002</span>
                  <span class="sample-status good">å®Œå¥½</span>
                </div>
                <div class="sample-location">ä¼šè®®å®¤BåŒºåŸŸ</div>
                <div class="sample-details">æ¥æ”¶æ—¶é—´ï¼š2025-09-04 17:30</div>
              </div>

              <div class="sample-card">
                <div class="sample-header">
                  <span class="sample-id">XW250903-100-003</span>
                  <span class="sample-status good">å®Œå¥½</span>
                </div>
                <div class="sample-location">æ€»ç»ç†åŠå…¬å®¤</div>
                <div class="sample-details">æ¥æ”¶æ—¶é—´ï¼š2025-09-04 17:30</div>
              </div>

              <div class="sample-card">
                <div class="sample-header">
                  <span class="sample-id">XW250903-100-004</span>
                  <span class="sample-status damaged">ç ´æŸ</span>
                </div>
                <div class="sample-location">è´¢åŠ¡å®¤</div>
                <div class="sample-details">æ¥æ”¶æ—¶é—´ï¼š2025-09-04 17:30</div>
              </div>

              <!-- ç®€åŒ–æ˜¾ç¤ºï¼Œå®é™…åº”è¯¥æ˜¾ç¤ºæ‰€æœ‰12ä¸ªæ ·å“ -->
              <div class="sample-card">
                <div class="sample-header">
                  <span class="sample-id">...</span>
                  <span class="sample-status good">æ›´å¤šæ ·å“</span>
                </div>
                <div class="sample-location">å…±è®¡12ä¸ªæ ·å“</div>
                <div class="sample-details">ç‚¹å‡»æŸ¥çœ‹å…¨éƒ¨</div>
              </div>
            </div>
          </div>
        </div>

        <!-- å³ä¾§çŠ¶æ€åŒº -->
        <div class="side-info">
          <!-- ä»»åŠ¡çŠ¶æ€æŒ‡ç¤ºå™¨ -->
          <div class="status-card">
            <div class="status-indicator pending" id="status-indicator">
              <div class="status-text" id="status-text">å¾…æ£€æµ‹</div>
            </div>
            <div class="status-details" id="status-details">
              <div class="status-detail-item">
                <span class="status-detail-label">å½“å‰é˜¶æ®µ</span>
                <span class="status-detail-value" id="current-phase"
                  >ç­‰å¾…å¼€å§‹æ£€æµ‹</span
                >
              </div>
              <div class="status-detail-item">
                <span class="status-detail-label">ä¼˜å…ˆçº§</span>
                <span class="status-detail-value" style="color: #ef4444"
                  >åŠ æ€¥</span
                >
              </div>
              <div class="status-detail-item">
                <span class="status-detail-label">åˆ†æ´¾æ—¶é—´</span>
                <span class="status-detail-value">2025-09-04 18:00</span>
              </div>
              <div class="status-detail-item">
                <span class="status-detail-label">é¢„è®¡å®Œæˆ</span>
                <span class="status-detail-value" id="expected-end"
                  >2025-09-06</span
                >
              </div>
            </div>
          </div>

          <!-- æ“ä½œæŒ‰é’®åŒº -->
          <div class="action-section" id="action-section">
            <div class="card-header">æ£€æµ‹æ“ä½œ</div>
            <div class="action-buttons" id="action-buttons">
              <!-- æ ¹æ®çŠ¶æ€åŠ¨æ€ç”ŸæˆæŒ‰é’® -->
            </div>
            <div class="action-note">
              <strong>æ³¨æ„ï¼š</strong
              >å¼€å§‹æ£€æµ‹åå°†è®°å½•æ£€æµ‹å¼€å§‹æ—¶é—´ï¼Œå®Œæˆæ£€æµ‹åå°†è®°å½•æ£€æµ‹ç»“æŸæ—¶é—´ï¼Œè¿™äº›æ—¶é—´å°†æ˜¾ç¤ºåœ¨æœ€ç»ˆæŠ¥å‘Šä¸­ã€‚
            </div>
          </div>

          <!-- æ£€æµ‹è¿›åº¦ï¼ˆæ£€æµ‹ä¸­çŠ¶æ€æ˜¾ç¤ºï¼‰ -->
          <div
            class="progress-section"
            id="progress-section"
            style="display: none"
          >
            <div class="progress-header">
              <div class="progress-title">æ£€æµ‹è¿›åº¦</div>
              <div class="progress-percentage" id="progress-percentage">
                65%
              </div>
            </div>
            <div class="progress-bar">
              <div
                class="progress-fill"
                id="progress-fill"
                style="width: 65%"
              ></div>
            </div>
            <div class="progress-details">
              <div class="progress-item">
                <div class="progress-item-value">5</div>
                <div class="progress-item-label">æ£€æµ‹é¡¹ç›®</div>
              </div>
              <div class="progress-item">
                <div class="progress-item-value">12</div>
                <div class="progress-item-label">æ£€æµ‹æ ·å“</div>
              </div>
            </div>
          </div>

          <!-- å®ŒæˆçŠ¶æ€çš„æ•°æ®è®¿é—®åŒº -->
          <div
            class="completion-section"
            id="completion-section"
            style="display: none"
          >
            <div
              class="card-header"
              style="
                color: #0ea5e9;
                border-bottom: 1px solid #0ea5e9;
                margin-bottom: 20px;
              "
            >
              æ£€æµ‹å®Œæˆ
            </div>
            <div class="status-details">
              <div class="status-detail-item">
                <span class="status-detail-label">å®é™…å¼€å§‹</span>
                <span class="status-detail-value">2025-09-05 09:30</span>
              </div>
              <div class="status-detail-item">
                <span class="status-detail-label">å®é™…å®Œæˆ</span>
                <span class="status-detail-value">2025-09-06 16:45</span>
              </div>
              <div class="status-detail-item">
                <span class="status-detail-label">å®é™…ç”¨æ—¶</span>
                <span class="status-detail-value">1.5å¤©</span>
              </div>
            </div>
            <div class="data-access-buttons">
              <a href="#" class="data-btn" onclick="viewTestReport()">
                <div class="data-btn-icon">ğŸ“Š</div>
                <div class="data-btn-title">æŸ¥çœ‹æ£€æµ‹æŠ¥å‘Š</div>
                <div class="data-btn-desc">PDFæ ¼å¼æŠ¥å‘Š</div>
              </a>
              <a href="#" class="data-btn" onclick="downloadData()">
                <div class="data-btn-icon">ğŸ“¥</div>
                <div class="data-btn-title">ä¸‹è½½æ£€æµ‹æ•°æ®</div>
                <div class="data-btn-desc">ExcelåŸå§‹æ•°æ®</div>
              </a>
              <a href="#" class="data-btn" onclick="viewCertificate()">
                <div class="data-btn-icon">ğŸ†</div>
                <div class="data-btn-title">æŸ¥çœ‹æ£€æµ‹è¯ä¹¦</div>
                <div class="data-btn-desc">å®˜æ–¹è®¤è¯æ–‡ä»¶</div>
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // è·å–URLå‚æ•°
      function getUrlParameter(name) {
        const urlParams = new URLSearchParams(window.location.search)
        return urlParams.get(name)
      }

      let taskStatus = getUrlParameter('status') || 'pending' // pending, processing/testing, completed
      const taskNumber = getUrlParameter('task') || 'XW250903-100'

      // ä»sessionStorageè¯»å–ä»»åŠ¡çŠ¶æ€å†å²è®°å½•
      function checkTaskHistory() {
        try {
          const taskHistory = JSON.parse(
            sessionStorage.getItem('taskHistory') || '{}'
          )
          if (taskHistory[taskNumber] && !getUrlParameter('status')) {
            taskStatus = taskHistory[taskNumber]
            // æ›´æ–°URLä»¥åæ˜ æ­£ç¡®çš„çŠ¶æ€
            const newUrl = `${window.location.pathname}?task=${taskNumber}&status=${taskStatus}`
            window.history.replaceState({}, '', newUrl)
          }
        } catch (e) {
          console.log('æ— æ³•è¯»å–ä»»åŠ¡å†å²è®°å½•')
        }
      }

      // æƒé™éªŒè¯
      function checkPermission() {
        const role = sessionStorage.getItem('role')
        const allowedRoles = ['lab-technician']

        if (!allowedRoles.includes(role)) {
          alert('æ‚¨æ²¡æœ‰æƒé™è®¿é—®æ­¤é¡µé¢ï¼Œå³å°†è·³è½¬åˆ°ç™»å½•é¡µé¢ã€‚')
          window.location.href = 'login.html'
          return false
        }
        return true
      }

      // è®¾ç½®é¡µé¢æ ‡é¢˜
      document.addEventListener('DOMContentLoaded', () => {
        // é¦–å…ˆæ£€æŸ¥æƒé™
        if (!checkPermission()) {
          return
        }

        if (window.limsNav) {
          window.limsNav.setPageTitle('æ£€æµ‹ä»»åŠ¡è¯¦æƒ…')
        }
        initializePage()
      })

      // åˆå§‹åŒ–é¡µé¢
      function initializePage() {
        checkTaskHistory() // æ£€æŸ¥ä»»åŠ¡çŠ¶æ€å†å²
        updateTaskInfo()
        updateStatusDisplay()
        updateActionButtons()
      }

      // æ›´æ–°ä»»åŠ¡ä¿¡æ¯
      function updateTaskInfo() {
        // æ›´æ–°é¡µé¢æ ‡é¢˜ä¸­çš„ä»»åŠ¡ç¼–å·
        document.querySelector('.project-number').textContent = taskNumber

        // æ ¹æ®çŠ¶æ€æ›´æ–°ä»»åŠ¡çŠ¶æ€æ ‡ç­¾
        const statusElement = document.querySelector('.task-status')
        const statusMap = {
          pending: { class: 'pending', text: 'å¾…æ£€æµ‹' },
          testing: { class: 'testing', text: 'æ£€æµ‹ä¸­' },
          processing: { class: 'testing', text: 'æ£€æµ‹ä¸­' },
          completed: { class: 'completed', text: 'å·²å®Œæˆ' }
        }

        const statusInfo = statusMap[taskStatus] || statusMap['pending']
        statusElement.className = `task-status ${statusInfo.class}`
        statusElement.textContent = statusInfo.text
      }

      // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
      function updateStatusDisplay() {
        const statusIndicator = document.getElementById('status-indicator')
        const statusText = document.getElementById('status-text')
        const currentPhase = document.getElementById('current-phase')
        const expectedEnd = document.getElementById('expected-end')
        const progressSection = document.getElementById('progress-section')
        const completionSection = document.getElementById('completion-section')

        const statusConfig = {
          pending: {
            class: 'pending',
            text: 'å¾…æ£€æµ‹',
            phase: 'ç­‰å¾…å¼€å§‹æ£€æµ‹'
          },
          testing: {
            class: 'testing',
            text: 'æ£€æµ‹ä¸­',
            phase: 'æ­£åœ¨æ£€æµ‹'
          },
          processing: {
            class: 'testing',
            text: 'æ£€æµ‹ä¸­',
            phase: 'æ­£åœ¨æ£€æµ‹'
          },
          completed: {
            class: 'completed',
            text: 'å·²å®Œæˆ',
            phase: 'æ£€æµ‹å®Œæˆ'
          }
        }

        const config = statusConfig[taskStatus] || statusConfig['pending']
        statusIndicator.className = `status-indicator ${config.class}`
        statusText.textContent = config.text
        currentPhase.textContent = config.phase

        // æ ¹æ®çŠ¶æ€æ˜¾ç¤º/éšè—ä¸åŒç»„ä»¶
        if (taskStatus === 'testing' || taskStatus === 'processing') {
          progressSection.style.display = 'block'
          completionSection.style.display = 'none'
          expectedEnd.textContent = '2025-09-07 17:00'

          // æ·»åŠ å®é™…å¼€å§‹æ—¶é—´
          const statusDetails = document.getElementById('status-details')
          if (!document.getElementById('actual-start-row')) {
            const actualStartRow = document.createElement('div')
            actualStartRow.className = 'status-detail-item'
            actualStartRow.id = 'actual-start-row'
            actualStartRow.innerHTML = `
                        <span class="status-detail-label">å®é™…å¼€å§‹</span>
                        <span class="status-detail-value">2025-09-05 09:30</span>
                    `
            statusDetails.insertBefore(
              actualStartRow,
              statusDetails.lastElementChild
            )
          }
        } else if (taskStatus === 'completed') {
          progressSection.style.display = 'none'
          completionSection.style.display = 'block'
          expectedEnd.textContent = '2025-09-06 16:45'

          // æ·»åŠ å®é™…å¼€å§‹æ—¶é—´
          const statusDetails = document.getElementById('status-details')
          if (!document.getElementById('actual-start-row')) {
            const actualStartRow = document.createElement('div')
            actualStartRow.className = 'status-detail-item'
            actualStartRow.id = 'actual-start-row'
            actualStartRow.innerHTML = `
                        <span class="status-detail-label">å®é™…å¼€å§‹</span>
                        <span class="status-detail-value">2025-09-05 09:30</span>
                    `
            statusDetails.insertBefore(
              actualStartRow,
              statusDetails.lastElementChild
            )
          }
        } else {
          progressSection.style.display = 'none'
          completionSection.style.display = 'none'
          expectedEnd.textContent = '2025-09-06'

          // ç§»é™¤å®é™…å¼€å§‹æ—¶é—´è¡Œ
          const actualStartRow = document.getElementById('actual-start-row')
          if (actualStartRow) {
            actualStartRow.remove()
          }
        }
      }

      // æ›´æ–°æ“ä½œæŒ‰é’®
      function updateActionButtons() {
        const actionButtons = document.getElementById('action-buttons')
        let buttonsHTML = ''

        switch (taskStatus) {
          case 'pending':
            buttonsHTML = `
                        <button class="action-btn start-btn" onclick="startTesting()">
                            <span>ğŸš€</span>
                            <span>å¼€å§‹æ£€æµ‹</span>
                        </button>
                    `
            break
          case 'testing':
          case 'processing':
            buttonsHTML = `
                        <button class="action-btn complete-btn" onclick="completeTesting()">
                            <span>âœ…</span>
                            <span>å®Œæˆæ£€æµ‹</span>
                        </button>
                    `
            break
          case 'completed':
            buttonsHTML = `
                        <div style="text-align: center; padding: 20px; color: #10b981;">
                            <span style="font-size: 48px;">âœ…</span>
                            <div style="margin-top: 12px; font-size: 16px; font-weight: 600;">æ£€æµ‹ä»»åŠ¡å·²å®Œæˆ</div>
                        </div>
                    `
            break
        }

        actionButtons.innerHTML = buttonsHTML
      }

      // å¼€å§‹æ£€æµ‹
      function startTesting() {
        if (confirm('ç¡®å®šå¼€å§‹æ£€æµ‹ä»»åŠ¡å—ï¼Ÿå¼€å§‹åå°†è®°å½•æ£€æµ‹å¼€å§‹æ—¶é—´ã€‚')) {
          // æ›´æ–°ä»»åŠ¡çŠ¶æ€
          taskStatus = 'processing'

          // æ›´æ–°URL
          const newUrl = `${window.location.pathname}?task=${taskNumber}&status=processing`
          window.history.pushState({}, '', newUrl)

          // é‡æ–°æ¸²æŸ“é¡µé¢
          updateTaskInfo()
          updateStatusDisplay()
          updateActionButtons()

          alert('æ£€æµ‹ä»»åŠ¡å·²å¼€å§‹ï¼è¯·æŒ‰ç…§æ£€æµ‹æ ‡å‡†è¿›è¡Œæ“ä½œã€‚')

          // é€šçŸ¥ä»»åŠ¡åˆ—è¡¨é¡µé¢æ›´æ–°ï¼ˆå¦‚æœåœ¨åŒä¸€ä¸ªä¼šè¯ä¸­ï¼‰
          if (window.opener && !window.opener.closed) {
            try {
              if (typeof window.opener.updateTaskStatus === 'function') {
                window.opener.updateTaskStatus(taskNumber, 'processing')
              }
            } catch (e) {
              console.log('æ— æ³•é€šçŸ¥ä»»åŠ¡åˆ—è¡¨é¡µé¢æ›´æ–°')
            }
          }

          // å¦‚æœä»å†å²è®°å½•è®¿é—®ï¼Œæ›´æ–°sessionStorage
          try {
            const taskHistory = JSON.parse(
              sessionStorage.getItem('taskHistory') || '{}'
            )
            taskHistory[taskNumber] = 'processing'
            sessionStorage.setItem('taskHistory', JSON.stringify(taskHistory))
          } catch (e) {
            console.log('æ— æ³•æ›´æ–°ä»»åŠ¡å†å²è®°å½•')
          }
        }
      }

      // å®Œæˆæ£€æµ‹
      function completeTesting() {
        if (
          confirm(
            'ç¡®å®šå®Œæˆæ£€æµ‹ä»»åŠ¡å—ï¼Ÿå®Œæˆåå°†è®°å½•æ£€æµ‹ç»“æŸæ—¶é—´ï¼Œä»»åŠ¡å°†è¿›å…¥å®ŒæˆçŠ¶æ€ã€‚'
          )
        ) {
          // æ›´æ–°ä»»åŠ¡çŠ¶æ€
          taskStatus = 'completed'

          // æ›´æ–°URL
          const newUrl = `${window.location.pathname}?task=${taskNumber}&status=completed`
          window.history.pushState({}, '', newUrl)

          // é‡æ–°æ¸²æŸ“é¡µé¢
          updateTaskInfo()
          updateStatusDisplay()
          updateActionButtons()

          alert('æ£€æµ‹ä»»åŠ¡å·²å®Œæˆï¼ç³»ç»Ÿå°†è‡ªåŠ¨é€šçŸ¥æŠ¥å‘Šç¼–åˆ¶äººå‘˜ç”Ÿæˆæ£€æµ‹æŠ¥å‘Šã€‚')

          // é€šçŸ¥ä»»åŠ¡åˆ—è¡¨é¡µé¢æ›´æ–°ï¼ˆå¦‚æœåœ¨åŒä¸€ä¸ªä¼šè¯ä¸­ï¼‰
          if (window.opener && !window.opener.closed) {
            try {
              if (typeof window.opener.updateTaskStatus === 'function') {
                window.opener.updateTaskStatus(taskNumber, 'completed')
              }
            } catch (e) {
              console.log('æ— æ³•é€šçŸ¥ä»»åŠ¡åˆ—è¡¨é¡µé¢æ›´æ–°')
            }
          }

          // å¦‚æœä»å†å²è®°å½•è®¿é—®ï¼Œæ›´æ–°sessionStorage
          try {
            const taskHistory = JSON.parse(
              sessionStorage.getItem('taskHistory') || '{}'
            )
            taskHistory[taskNumber] = 'completed'
            sessionStorage.setItem('taskHistory', JSON.stringify(taskHistory))
          } catch (e) {
            console.log('æ— æ³•æ›´æ–°ä»»åŠ¡å†å²è®°å½•')
          }
        }
      }

      // å¯¼å‡ºä»»åŠ¡ä¿¡æ¯
      function exportTaskInfo() {
        alert(`æ­£åœ¨å¯¼å‡ºä»»åŠ¡ ${taskNumber} çš„è¯¦ç»†ä¿¡æ¯...`)
      }

      // æŸ¥çœ‹æ£€æµ‹æŠ¥å‘Š
      function viewTestReport() {
        alert(`æ­£åœ¨æ‰“å¼€ä»»åŠ¡ ${taskNumber} çš„æ£€æµ‹æŠ¥å‘Š...`)
      }

      // ä¸‹è½½æ£€æµ‹æ•°æ®
      function downloadData() {
        alert(`æ­£åœ¨ä¸‹è½½ä»»åŠ¡ ${taskNumber} çš„æ£€æµ‹æ•°æ®...`)
      }

      // æŸ¥çœ‹æ£€æµ‹è¯ä¹¦
      function viewCertificate() {
        alert(`æ­£åœ¨æ‰“å¼€ä»»åŠ¡ ${taskNumber} çš„æ£€æµ‹è¯ä¹¦...`)
      }

      // é¡µé¢åŠ è½½åŠ¨ç”»
      window.addEventListener('load', function () {
        const cards = document.querySelectorAll(
          '.info-card, .status-card, .action-section'
        )
        cards.forEach((card, index) => {
          card.style.opacity = '0'
          card.style.transform = 'translateY(20px)'
          setTimeout(() => {
            card.style.transition = 'all 0.3s ease'
            card.style.opacity = '1'
            card.style.transform = 'translateY(0)'
          }, index * 100)
        })
      })
    </script>
  </body>
</html>
